<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>TERMINAL : --</title>
    <link rel="icon" type="image/png" href="icon.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;700&family=Fira+Code:wght@400;700&family=IBM+Plex+Mono:wght@400;700&family=Source+Code+Pro:wght@400;700&family=Inconsolata:wght@400;700&family=Roboto+Mono:wght@400;700&family=Ubuntu+Mono:wght@400;700&family=VT323&display=swap"
      rel="stylesheet"
    />
    <script src="./d3.v7.min.js"></script>
    <style>
      :root {
        --main-color: #00ff41;
        --secondary-color: #888888;
        --bg-overlay: rgba(0, 0, 0, 0.95);
        --danger-color: #ff0055;
        --warning-color: #ffb800;
        --text-shadow:
          0 0 10px rgba(0, 0, 0, 1), 0 0 20px rgba(0, 0, 0, 1),
          0 2px 8px rgba(0, 0, 0, 1), 2px 2px 4px rgba(0, 0, 0, 0.9);
        --font-main: "Space Mono", monospace;
        --font-secondary: "Space Mono", monospace;
        --dim-color: #555555;
        --board-color: #00d4ff;

        /* V87: Knowledge Graph Cluster Palette */
        --graph-col-1: #00ff41; /* Green (Main) */
        --graph-col-2: #00e5ff; /* Cyan */
        --graph-col-3: #ff0055; /* Red/Pink */
        --graph-col-4: #ffb800; /* Orange */
        --graph-col-5: #9d00ff; /* Purple */

        /* DEFAULT TERMINAL THEME (Syntax & Callouts) */
        --syntax-string: #f1fa8c;
        --syntax-comment: #6272a4;
        --syntax-keyword: #ff79c6;
        --syntax-boolean: #bd93f9;
        --syntax-number: #8be9fd;

        --callout-info: #00E5FF;
        --callout-warning: #FFB800;
        --callout-danger: #FF0055;
        --callout-success: #00FF41;
        --callout-note: #9D00FF;
        --callout-tip: #FFD700;
        --callout-quote: #888888;
        
        /* SEMANTIC Z-INDEX HIERARCHY */
        --z-base: 0;
        --z-content: 10;
        --z-overlay: 50;
        --z-nav: 100;
        --z-widget: 1000;
        --z-search: 9000;
        --z-topbar: 9999;
        
        /* MODALS & OVERLAYS */
        --z-modal-backdrop: 20000;
        --z-modal-base: 21000;
        --z-modal-maximized: 25000;
        --z-modal-child: 26000;
        
        /* CRITICAL UI / CONTEXT MENUS */
        --z-context-menu: 30000;
        --z-tooltip: 35000;
        --z-toast: 40000;
      }

      /* RETROMA THEME OVERRIDE */
      body.theme-retroma {
        /* Core Retroma Colors */
        --main-bg: #e6ddce;
        --main-color: #a54a3c;
        --text-primary: #433e38;
        --secondary-color: #7c766e;
        --dim-color: #9e9589;
        
        /* Muted Syntax Highlighting */
        --syntax-string: #427c52;
        --syntax-comment: #9e9589;
        --syntax-keyword: #a54a3c;
        --syntax-boolean: #5d8b88;
        --syntax-number: #a54a3c;

        /* Muted Callouts */
        --callout-info: #5d8b88;
        --callout-warning: #c48630;
        --callout-danger: #a54a3c;
        --callout-success: #427c52;
        --callout-note: #5d8b88;
        --callout-tip: #c48630;
        --callout-quote: #7c766e;
      }

      /* Callout Styling Logic */
      .block-callout {
          border-left: 4px solid var(--callout-color, var(--callout-info));
          background-color: color-mix(in srgb, var(--callout-color, var(--callout-info)) 15%, transparent);
          padding: 15px; 
          margin: 4px 0; 
          border-radius: 4px;
          position: relative;
          width: 100%;
          box-sizing: border-box;
      }
      .block-callout.callout-info { --callout-color: var(--callout-info); }
      .block-callout.callout-warning { --callout-color: var(--callout-warning); }
      .block-callout.callout-danger { --callout-color: var(--callout-danger); }
      .block-callout.callout-success { --callout-color: var(--callout-success); }
      .block-callout.callout-note { --callout-color: var(--callout-note); }
      .block-callout.callout-tip { --callout-color: var(--callout-tip); }
      .block-callout.callout-quote { --callout-color: var(--callout-quote); }

      .callout-header { display: flex; align-items: center; gap: 8px; font-weight: bold; color: var(--callout-color); margin-bottom: 8px; }
      .callout-body { color: var(--text-primary, #ccc); line-height: 1.6; }


      /* UPDATE: Prevent text selection generally, allow on inputs */
      * {
        box-sizing: border-box;
        user-select: none;
        -webkit-user-select: none;
      }

      input,
      textarea,
      .block-content,
      [contenteditable="true"] {
        user-select: text;
        -webkit-user-select: text;
      }

      #shortcut-hint {
        position: fixed;
        bottom: 20px;
        width: 100%;
        text-align: center;
        font-size: 0.75rem;
        color: var(--secondary-color);
        opacity: 0.7;
        pointer-events: none;
        font-family: var(--font-secondary);
      }

      /* V89: Notion-Style Drag Handle */
      /* Position the handle absolutely in the left gutter */
      .block-wrapper {
          position: relative;
          padding-left: 30px; /* Make room for the handle */
          margin-bottom: 2px;
      }

      .block-drag-handle {
          position: absolute;
          left: 4px;
          top: 4px; /* Align with first line of text */
          width: 20px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: grab;
          opacity: 0;
          transition: opacity 0.15s ease;
          border-radius: 3px;
          color: var(--secondary-color);
      }

      /* Show handle on hover */
      .block-wrapper:hover .block-drag-handle,
      .block-wrapper.block-selected .block-drag-handle {
          opacity: 1;
      }

      .block-drag-handle:hover {
          background: rgba(255, 255, 255, 0.1);
          color: var(--main-color);
      }

      .block-drag-handle:active {
          cursor: grabbing;
      }

      /* Visual feedback for the selected block */
      .block-wrapper.block-selected {
          background: rgba(var(--main-color-rgb), 0.1);
          border-radius: 4px;
      }

      /* Dragging State (Moved from Legacy) */
      .block-wrapper.dragging {
        opacity: 0.4;
        border: 1px dashed var(--main-color);
      }

      #shortcut-hint kbd {
        border: 1px solid var(--secondary-color);
        border-radius: 3px;
        padding: 2px 4px;
        font-size: 0.7rem;
        margin: 0 2px;
        font-family: inherit;
      }

      #cmd-input::placeholder {
        color: var(--secondary-color);
        font-family: var(--font-secondary);
        opacity: 0.5;
        font-style: italic;
      }

      .status-item .label,
      .weather-extra .label,
      .pomodoro-label {
        color: var(--secondary-color);
        font-family: var(--font-secondary);
      }

      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #000;
        font-family: "Space Mono", monospace;
        color: var(--main-color);
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      body.theme-retroma {
          background-color: var(--main-bg);
          color: var(--text-primary);
      }

      /* CRT SCANLINE EFFECT */
      .crt-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        background: repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.15),
          rgba(0, 0, 0, 0.15) 1px,
          transparent 1px,
          transparent 2px
        );
      }

      .crt-overlay.active {
        display: block;
      }

      /* V3.9: Inline Link Popover */
      #link-popover {
        position: fixed;
        display: none;
        z-index: calc(var(--z-context-menu) + 2); /* V38: Higher than editor and slash-menu */
        background: #111;
        border: 1px solid var(--main-color);
        padding: 12px;
        border-radius: 6px;
        box-shadow:
          0 4px 30px rgba(0, 0, 0, 0.9),
          0 0 15px rgba(0, 255, 65, 0.2);
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
        width: 320px;
        cursor: default;
      }

      #link-popover.active {
        display: flex;
      }

      #link-popover .popover-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
      }

      #link-popover .popover-label {
        font-size: 0.7rem;
        color: var(--secondary-color);
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: var(--font-secondary);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 260px;
      }

      #link-popover input {
        background: #000;
        border: 1px solid #333;
        color: var(--main-color);
        padding: 10px;
        border-radius: 4px;
        font-family: var(--font-secondary);
        font-size: 0.9rem;
        outline: none;
        width: 100%;
      }

      #link-popover input:focus {
        border-color: var(--main-color);
      }

      #link-popover button {
        background: var(--main-color);
        color: #000;
        border: none;
        padding: 6px 12px;
        border-radius: 3px;
        cursor: pointer;
        font-family: var(--font-main);
        font-weight: bold;
        font-size: 0.85rem;
        transition: all 0.2s;
      }

      #link-popover button:hover {
        filter: brightness(1.2);
        transform: translateY(-1px);
      }

      #link-popover .popover-label {
        font-size: 0.65rem;
        color: var(--secondary-color);
        position: absolute;
        top: -16px;
        left: 5px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* VIGNETTE EFFECT (V17) */
      .vignette-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        background: radial-gradient(
          ellipse at center,
          transparent 40%,
          rgba(0, 0, 0, 0.7) 100%
        );
      }

      .vignette-overlay.active {
        display: block;
      }

      /* NOISE/GRAIN EFFECT (V17) */
      .noise-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9997;
        opacity: 0.05;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      }

      .noise-overlay.active {
        display: block;
      }

      /* VIDEO LAYER */
      #bg-video {
        position: absolute;
        top: 50%;
        left: 50%;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        transform: translate(-50%, -50%);
        z-index: 0;
        object-fit: cover;
        opacity: 0;
        transition: opacity 0.4s ease-in-out;
      }

      /* ICONS & BUTTONS */
      /* UPDATE: Raise Z-Index above Overlay (10000) and Modals (10001) */
      #config-btn {
        position: absolute;
        top: 30px;
        left: 30px;
        width: 24px;
        height: 24px;
        cursor: pointer;
        z-index: 22000; /* V27: Forefront above settings (21000) but below alerts (30000) */
        opacity: 0.5;
        transition: all 0.3s;
        fill: var(--main-color);
        filter: drop-shadow(var(--text-shadow));
        pointer-events: auto; /* V21: Ensure clickable over overlay */
      }

      #config-btn:hover {
        opacity: 1;
        transform: rotate(90deg);
      }

      /* HELP BUTTON */
      /* UPDATE: Raise Z-Index above Overlay */
      #help-btn {
        position: absolute;
        top: 30px;
        left: 65px;
        width: 24px;
        height: 24px;
        cursor: pointer;
        z-index: 22000; /* V27: Forefront above settings (21000) but below alerts (30000) */
        opacity: 0.5;
        transition: all 0.3s;
        color: var(--main-color);
        font-weight: bold;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--main-color);
        border-radius: 50%;
        filter: drop-shadow(var(--text-shadow));
        user-select: none;
        -webkit-user-select: none;
        pointer-events: auto; /* V21: Ensure clickable over overlay */
      }

      #help-btn:hover {
        opacity: 1;
      }

      /* TOP STATUS BAR */
      #status-bar {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 30px;
        font-size: 0.75rem;
        z-index: 30;
      }

      .status-item {
        display: flex;
        align-items: center;
        gap: 5px;
        text-shadow: var(--text-shadow);
      }

      .status-item .label {
        color: var(--secondary-color);
        font-family: var(--font-secondary);
      }

      .status-item .value {
        color: var(--main-color);
      }

      /* WEATHER WIDGET */
      #weather-widget {
        position: absolute;
        top: 30px;
        right: 30px;
        background: rgba(0, 0, 0, 0.85);
        border: 1px solid #333;
        padding: 12px 16px;
        z-index: 50;
        display: none;
        min-width: 140px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        color: var(--main-color); /* V102: Fix visibility */
      }

      #weather-widget.active {
        display: block;
      }

      .weather-main {
        display: flex;
        align-items: baseline;
        gap: 5px;
      }

      .weather-temp {
        font-size: 1.8rem;
        color: var(--main-color);
        font-weight: bold;
      }

      .weather-unit {
        font-size: 1rem;
        color: var(--main-color);
        opacity: 0.7;
      }

      /* V63.4: Sidebar Active Tag Highlight */
      .tag-item.active-tag,
      .tag.active-tag {
        color: var(--main-color);
        border-color: var(--main-color);
        text-shadow: 0 0 5px rgba(var(--main-color-rgb), 0.5);
        background: rgba(var(--main-color-rgb), 0.15);
        opacity: 1;
      }

      .tag-item:hover {
        color: var(--main-color);
        background: #252525;
      }

      .weather-condition {
        font-size: 0.75rem;
        color: var(--secondary-color);
        text-transform: uppercase;
        margin-top: 5px;
        font-family: var(--font-secondary);
      }

      .weather-location {
        font-size: 0.8rem;
        color: var(--secondary-color);
        margin-top: 8px;
        border-top: 1px solid #333;
        padding-top: 8px;
        font-family: var(--font-secondary);
        letter-spacing: 1px;
      }

      .weather-extra {
        display: none;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid #333;
        font-size: 0.75rem;
        color: var(--secondary-color);
      }

      .weather-extra.active {
        display: block;
      }

      .weather-extra-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
      }

      .weather-extra-row .label {
        color: var(--secondary-color);
        font-family: var(--font-secondary);
      }

      .weather-extra-row .value {
        color: var(--main-color);
      }

      .weather-toggle {
        font-size: 0.7rem;
        color: var(--secondary-color);
        cursor: pointer;
        text-align: center;
        margin-top: 8px;
        text-transform: uppercase;
        opacity: 0.7;
      }

      .weather-toggle:hover {
        color: var(--main-color);
      }

      /* MODALS */
      .modal {
        display: none;
        position: fixed;
        /* V19.18: Modern centering - fixes subpixel blur */
        inset: 0;
        margin: auto;
        width: 550px;
        max-width: 95vw;
        max-height: 80vh; /* V15.7: Increased height for better visibility */
        background: var(--bg-overlay);
        border: 1px solid var(--main-color);
        padding: 0;
        z-index: var(--z-modal-base); /* V15.3: Sync with ModalManager base */
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
        text-align: left;
        overflow: hidden; /* V15.7: Parent should not scroll, children should */
        color: #ccc;
        flex-direction: column;
      }

      /* V18.7: Modal overlay backdrop with blur */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        z-index: var(--z-modal-backdrop);
      }

      .modal-overlay.active {
        display: block;
      }

      .modal.active {
        display: flex !important;
        z-index: calc(var(--z-modal-base) + 1);
      }

      /* V15.8: Highly visible scrollbars for accessibility */
      .modal-body::-webkit-scrollbar,
      .note-preview::-webkit-scrollbar,
      .notes-sidebar::-webkit-scrollbar,
      .config-content::-webkit-scrollbar,
      .block-editor::-webkit-scrollbar,
      .config-input::-webkit-scrollbar,
      #dock-list::-webkit-scrollbar,
      #mission-log::-webkit-scrollbar,
      #custom-cmd-list::-webkit-scrollbar,
      .page-actions-list::-webkit-scrollbar {
        width: 8px;
        display: block !important;
      }

      .modal-body::-webkit-scrollbar-thumb,
      .note-preview::-webkit-scrollbar-thumb,
      .notes-sidebar::-webkit-scrollbar-thumb,
      .config-content::-webkit-scrollbar-thumb,
      .block-editor::-webkit-scrollbar-thumb,
      .config-input::-webkit-scrollbar-thumb,
      #dock-list::-webkit-scrollbar-thumb,
      #mission-log::-webkit-scrollbar-thumb,
      #custom-cmd-list::-webkit-scrollbar-thumb,
      .page-actions-list::-webkit-scrollbar-thumb {
        background: var(--main-color);
        border-radius: 4px;
        border: 2px solid var(--bg-overlay);
      }

      .modal-body::-webkit-scrollbar-track,
      .note-preview::-webkit-scrollbar-track,
      .notes-sidebar::-webkit-scrollbar-track,
      .config-content::-webkit-scrollbar-track,
      .block-editor::-webkit-scrollbar-track,
      .config-input::-webkit-scrollbar-track,
      #dock-list::-webkit-scrollbar-track,
      #mission-log::-webkit-scrollbar-track,
      #custom-cmd-list::-webkit-scrollbar-track,
      .page-actions-list::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
      }

      /* --- textarea resizer fix --- */
      #note-editor-textarea {
        min-height: 200px;
        margin-bottom: 15px;
      }

      /* V19.25: Global textarea resizer styling */
      textarea::-webkit-resizer {
        background-color: #000;
        border: 1px solid #000;
        background-image: radial-gradient(
          circle,
          var(--main-color) 1px,
          transparent 1px
        );
        background-size: 4px 4px;
        background-position: bottom right;
      }

      .config-header {
        padding: 15px 20px;
        border-bottom: 1px solid #333;
        background: #0a0a0a;
        color: var(--main-color);
        font-weight: bold;
        font-size: 1.2rem;
        letter-spacing: 2px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
        /* V19.5: Never shrink */
        height: 60px;
        /* V19.5: Fixed height */
        position: sticky;
        top: 0;
        width: 100%;
        box-sizing: border-box;
        z-index: 50;
        /* Increased Z-Index */
        box-shadow: 0 1px 0 #333;
        /* Bottom border visual */
      }

      #pin-note-btn.active {
        background: var(--main-color);
        color: #000;
        border-color: var(--main-color);
      }

      #header-save-btn {
        background: var(--main-color);
        color: #000;
        border: none;
        padding: 5px 15px;
        font-size: 0.8rem;
        cursor: pointer;
        font-family: inherit;
        font-weight: bold;
        transition: all 0.2s;
      }

      #header-save-btn:hover {
        box-shadow: 0 0 10px var(--main-color);
        background: #fff;
      }

      /* V19.30: Header Update Theme button */
      #header-update-btn {
        background: transparent;
        color: var(--main-color);
        border: 1px solid var(--main-color);
        padding: 5px 15px;
        font-size: 0.75rem;
        cursor: pointer;
        font-family: inherit;
        transition: all 0.2s;
      }

      #header-update-btn:hover {
        background: var(--main-color);
        color: #000;
        box-shadow: 0 0 10px var(--main-color);
      }

      #help-btn:hover {
        opacity: 1;
        box-shadow: 0 0 10px var(--main-color);
      }

      .close-modal {
        position: relative; /* V70: Flexbox alignment */
        /* Removed absolute pos top/right */
        cursor: pointer;
        color: var(--secondary-color);
        transition: all 0.2s;
        /* V69: Square Design matching image-delete-btn */
        width: 30px;
        height: 30px;
        border: 1px solid var(--dim-color);
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.5);
        font-family: var(--font-main);
        font-size: 0.9rem;
        z-index: 10;
        margin-left: 15px; /* V70: Spacing from content */
      }

      /* V67: Preview Mode Styles */
      .note-preview blockquote {
        border-left: 4px solid var(--main-color);
        margin-left: 0;
        padding-left: 15px;
        color: #ccc;
        font-style: italic;
      }
      .note-preview .preview-bullet {
        display: flex;
        align-items: flex-start;
        margin-bottom: 5px;
      }
      .note-preview .preview-bullet-icon {
        margin-right: 10px;
        flex-shrink: 0;
        color: var(--main-color);
      }

      /* V89: Fix for Preview Checkbox Alignment */
      .block-task-preview {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-bottom: 5px;
      }

      /* V68: Preview Alignment Support for Flex Items */
      .note-preview .preview-bullet.align-center,
      .note-preview .block-task-preview.align-center {
        justify-content: center;
        text-align: center;
      }
      .note-preview .preview-bullet.align-right,
      .note-preview .block-task-preview.align-right {
        justify-content: flex-end;
        text-align: right;
      }

      /* V71: Calculator Preview Styles */
      .calc-preview {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid #333;
        border-radius: 4px;
        padding: 10px 15px;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.9rem;
        color: #ccc;
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 10px 0;
      }
      .calc-expression {
        color: #888;
      }
      .calc-arrow {
        color: #555;
        font-size: 0.8rem;
      }
      .calc-result {
        color: var(--main-color);
        font-weight: bold;
      }

      .close-modal:hover {
        color: var(--danger-color);
        border-color: var(--danger-color);
        background: rgba(255, 68, 68, 0.1);
      }

      /* V18.13: BIOS-Style Settings Layout */
      /* V19.19: Base modal sizing only */
      #config-modal {
        width: 800px;
        max-width: 95vw;
      }

      /* V19.19: Active state controls layout and scrolling */
      #config-modal.active {
        display: flex !important;
        flex-direction: column;
        height: auto;
        max-height: 80vh;
        overflow-y: auto;
      }

      .config-header {
        flex: 0 0 auto;
        /* V19.8: Do not grow, do not shrink */
      }

      .config-body {
        display: flex;
        /* Row layout for Sidebar + Content */
        flex: 1;
        /* Consume ALL available vertical space */
        min-height: 0;
        /* V19.16: Removed overflow: hidden - was blocking .config-content scroll */
      }

      .config-sidebar {
        width: 200px;
        min-width: 200px;
        background: #050505;
        /* V19.11: Dark to visualize full height */
        border-right: 1px solid #333;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        /* V19.11: Independent scroll */
      }

      .config-search {
        padding: 10px;
        border-bottom: 1px solid #222;
      }

      .config-search input {
        width: 100%;
        background: #111;
        border: 1px solid #333;
        color: #ccc;
        padding: 8px 10px;
        font-family: inherit;
        font-size: 0.75rem;
        box-sizing: border-box;
      }

      .config-search input:focus {
        border-color: var(--main-color);
        outline: none;
      }

      .config-search input::placeholder {
        color: #555;
      }

      .config-nav {
        flex: 1;
        overflow-y: auto;
      }

      .config-nav-item {
        display: block;
        padding: 12px 15px;
        color: #888;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        border-left: 3px solid transparent;
        transition: all 0.2s;
      }

      .config-nav-item:hover {
        background: #151515;
        color: #ccc;
      }

      .config-nav-item.active {
        background: #111;
        color: var(--main-color);
        border-left-color: var(--main-color);
      }

      .config-nav-item.hidden {
        display: none;
      }

      .config-content {
        /* V19.15: Force height constraint for scroll */
        flex: 1;
        height: 100%;
        /* Forces constraint to parent */
        min-height: 0;
        overflow-y: auto;
        padding: 20px;
        padding-bottom: 60px;
        box-sizing: border-box;
        background: #0d0d0d;
      }

      /* V15.3+: Standardized Modal Scrollbars */
      .config-content::-webkit-scrollbar,
      .config-nav::-webkit-scrollbar {
        width: 8px;
      }

      .config-content::-webkit-scrollbar-thumb,
      .config-nav::-webkit-scrollbar-thumb {
        background: var(--main-color);
      }

      .config-content::-webkit-scrollbar-track,
      .config-nav::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
      }

      .config-tab {
        display: none;
      }

      .config-tab.active {
        display: block;
      }

      .config-tab-title {
        color: var(--main-color);
        font-size: 1rem;
        font-weight: bold;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #333;
      }

      .config-footer {
        padding: 15px 20px;
        background: #0a0a0a;
        border-top: 1px solid #333;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        /* V19.3: Align buttons */
        gap: 10px;
        position: relative;
        /* V19.2.2: Ensure visibility */
        z-index: 50;
      }

      .config-footer button {
        padding: 10px 20px;
        font-size: 0.8rem;
        font-weight: bold;
        cursor: pointer;
        border: 1px solid;
        font-family: inherit;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn-save {
        background: var(--main-color);
        color: #000;
        border-color: var(--main-color);
      }

      .btn-save:hover {
        background: #fff;
        color: #000;
      }

      .btn-save-close {
        background: #222;
        color: var(--main-color);
        border-color: var(--main-color);
      }

      .btn-save-close:hover {
        background: var(--main-color);
        color: #000;
      }

      .btn-cancel {
        background: transparent;
        color: #888;
        border-color: #555;
      }

      .btn-cancel:hover {
        background: #333;
        color: #fff;
      }

      /* COLLAPSIBLE SECTIONS */
      .config-section {
        border-bottom: 1px solid #222;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        cursor: pointer;
        background: #0a0a0a;
        color: var(--main-color);
        font-weight: bold;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .section-header:hover {
        background: #151515;
      }

      .section-header .toggle-icon {
        transition: transform 0.3s;
      }

      .section-header.collapsed .toggle-icon {
        transform: rotate(-90deg);
      }

      .section-body {
        padding: 15px 20px;
        display: block;
      }

      .section-body.collapsed {
        display: none;
      }

      .config-group,
      .config-row {
        /* V19.15: Unified 20px padding */
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px dashed #333;
        padding: 20px 0;
        /* Unified with slider-row/toggle-row */
        margin-bottom: 0;
      }

      .config-label {
        color: #888;
        font-size: 0.75rem;
        display: block;
        margin-bottom: 0;
        /* Override old margin */
        flex-shrink: 0;
        /* V19.7: Prevent text squishing */
      }

      .config-hint {
        color: #555;
        font-size: 0.65rem;
        margin-top: 3px;
      }

      .config-input {
        /* V19.9: Terminal Uniformity */
        background-color: #000;
        color: var(--main-color);
        border: 1px solid #333;
        font-family: "Space Mono", monospace;
        box-sizing: border-box;
        padding: 8px 12px;
        height: 35px;
        width: 220px;
        /* Fixed width */
        font-size: 0.85rem;
        outline: none;
      }

      .config-input.wide-input {
        width: 100%;
      }

      /* Color Picker Styling */
      input[type="color"].config-input {
        height: 40px;
        padding: 4px;
        cursor: pointer;
      }

      input[type="color"].config-input::-webkit-color-swatch-wrapper {
        padding: 0;
      }

      input[type="color"].config-input::-webkit-color-swatch {
        border: 1px solid #333;
        border-radius: 2px;
      }

      .config-input:focus {
        border-color: var(--main-color);
      }

      .config-input::placeholder {
        color: #444;
      }

      /* THEME ACTION BUTTONS (V17) */
      .theme-action-btn {
        flex: 1;
        background: #1a1a1a;
        border: 1px solid #333;
        color: var(--main-color);
        padding: 8px 12px;
        font-family: "Space Mono", monospace;
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.2s;
        text-transform: uppercase;
      }

      .theme-action-btn:hover {
        background: var(--main-color);
        color: #000;
        border-color: var(--main-color);
      }

      .theme-delete-btn {
        width: 100%;
        margin-top: 10px;
        background: transparent;
        border: 1px solid var(--danger-color);
        color: var(--danger-color);
        padding: 8px 12px;
        font-family: "Space Mono", monospace;
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.2s;
        text-transform: uppercase;
      }

      .theme-delete-btn:hover {
        background: var(--danger-color);
        color: #000;
      }

      /* SLIDER INPUT - V19.14: Unified row spacing */
      .slider-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        border-bottom: 1px dashed #333;
        padding: 20px 0;
        margin-bottom: 0;
        min-height: 50px;
      }

      .slider-row .slider-label {
        color: #888;
        font-size: 0.75rem;
        min-width: 100px;
      }

      .slider-row input[type="range"] {
        flex: 1;
        -webkit-appearance: none;
        appearance: none;
        background: #222;
        height: 4px;
        border-radius: 2px;
        outline: none;
      }

      /* Custom scrollbar for textareas */
      textarea::-webkit-scrollbar {
        width: 8px; /* Standardized in V15.3 */
      }

      textarea::-webkit-scrollbar-thumb {
        background: var(--main-color);
      }

      textarea::-webkit-scrollbar-track {
        background: #0a0a0a;
      }

      .slider-row input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 14px;
        height: 14px;
        background: var(--main-color);
        border-radius: 50%;
        cursor: pointer;
      }

      .slider-row .slider-value {
        color: var(--main-color);
        font-size: 0.75rem;
        min-width: 40px;
        text-align: right;
      }

      /* TOGGLE SWITCH - V19.14: Unified row spacing */
      .toggle-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px dashed #333;
        padding: 20px 0;
        margin-bottom: 0;
        min-height: 50px;
      }

      .toggle-label {
        color: #aaa;
        font-size: 0.8rem;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 22px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #333;
        transition: 0.3s;
        border-radius: 22px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--main-color);
      }

      input:checked + .slider:before {
        transform: translateX(22px);
        background-color: #000;
      }

      /* DOCK EDITOR */
      #dock-list {
        max-height: 180px;
        overflow-y: auto;
        border: 1px solid #222;
        margin-bottom: 10px;
      }

      .dock-item {
        display: flex;
        gap: 8px;
        align-items: center;
        padding: 8px;
        border-bottom: 1px solid #1a1a1a;
        background: #0a0a0a;
      }

      .dock-item:hover {
        background: #111;
      }

      .dock-item .drag-handle {
        color: #444;
        padding: 0 5px;
      }

      .dock-item input {
        flex: 1;
        background: transparent;
        border: none;
        color: #aaa;
        font-family: "Space Mono", monospace;
        font-size: 0.8rem;
        padding: 5px;
      }

      .dock-item input:focus {
        color: var(--main-color);
        outline: none;
      }

      .dock-item .remove-btn {
        color: var(--danger-color);
        cursor: pointer;
        padding: 0 8px;
        font-weight: bold;
      }

      /* COMMAND LIST */
      #custom-cmd-list {
        max-height: 120px;
        overflow-y: auto;
        border: 1px solid #222;
        margin-bottom: 10px;
      }

      .cmd-row {
        display: flex;
        gap: 5px;
        padding: 5px;
        border-bottom: 1px solid #1a1a1a;
      }

      .cmd-row input {
        flex: 1;
        background: transparent;
        border: none;
        color: #aaa;
        padding: 5px;
        font-family: "Space Mono", monospace;
        font-size: 0.8rem;
      }

      .remove-cmd {
        color: var(--danger-color);
        cursor: pointer;
        padding: 0 8px;
        font-weight: bold;
      }

      .btn-row {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        border-top: 1px solid #333;
        position: sticky;
        bottom: 0;
        background: var(--bg-overlay);
      }

      button {
        font-family: "Space Mono", monospace;
        font-weight: bold;
        cursor: pointer;
        border: none;
        padding: 12px 15px;
      }

      #save-config {
        flex: 2;
        background: var(--main-color);
        color: #000;
      }

      #save-config:hover {
        box-shadow: 0 0 15px var(--main-color);
      }

      #reset-config {
        flex: 1;
        background: #1a0000;
        color: var(--danger-color);
        border: 1px solid var(--danger-color);
      }

      #reset-config:hover {
        background: var(--danger-color);
        color: #000;
      }

      .action-btn {
        background: #1a1a1a;
        color: #888;
        border: 1px solid #333;
        padding: 8px 12px;
        font-size: 0.8rem;
      }

      .action-btn:hover {
        border-color: var(--main-color);
        color: var(--main-color);
      }

      .add-row {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
      }

      .add-row input {
        flex: 1;
      }

      .add-row button {
        padding: 10px 15px;
        background: var(--main-color);
        color: #000;
      }

      /* V102: ZEN MODE */
      body.zen-mode #status-bar,
      body.zen-mode #weather-widget,
      body.zen-mode #config-btn,
      body.zen-mode #help-btn,
      body.zen-mode .notes-sidebar,
      body.zen-mode #dock,
      body.zen-mode #greeting,
      body.zen-mode #progress-container {
        display: none !important;
        opacity: 0;
        pointer-events: none;
      }

      /* Center the HUD if it isn't already */
      /* body.zen-mode .hud-container - Already centered */

      /* HUD ELEMENTS */
      .hud-container {
        position: absolute;
        top: 42%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: var(--main-color);
        z-index: 10;
        width: 85%;
        max-width: 850px;
      }

      #greeting {
        font-size: 1rem;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 3px;
        margin-bottom: 10px;
        text-shadow: var(--text-shadow);
      }

      #greeting .name {
        color: var(--main-color);
      }

      #clock {
        font-size: 7rem;
        font-weight: bold;
        letter-spacing: -5px;
        text-shadow:
          0 0 30px rgba(0, 255, 65, 0.15),
          var(--text-shadow);
        margin-bottom: 0px;
        line-height: 1;
      }

      #date {
        font-size: 1.1rem;
        letter-spacing: 5px;
        text-transform: uppercase;
        opacity: 0.7;
        margin-bottom: 35px;
        text-shadow: var(--text-shadow);
      }

      /* POMODORO TIMER */
      #pomodoro-container {
        display: none;
        margin-bottom: 20px;
      }

      #pomodoro-container.active {
        display: block;
      }

      .pomodoro-display {
        display: inline-flex;
        align-items: center;
        gap: 15px;
        background: rgba(0, 0, 0, 0.9);
        border: 2px solid var(--main-color);
        padding: 15px 25px;
        box-shadow: 0 0 30px rgba(0, 255, 65, 0.2);
      }

      .pomodoro-time {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--main-color);
        font-family: var(--font-main);
        letter-spacing: 2px;
      }

      .pomodoro-label {
        font-size: 0.7rem;
        color: #666;
        text-transform: uppercase;
        font-family: var(--font-secondary);
        letter-spacing: 1px;
      }

      .pomodoro-controls {
        display: flex;
        gap: 10px;
      }

      .pomodoro-btn {
        background: transparent;
        border: 1px solid #444;
        color: #888;
        padding: 8px 15px;
        font-size: 0.75rem;
        text-transform: uppercase;
      }

      .pomodoro-btn:hover {
        border-color: var(--main-color);
        color: var(--main-color);
      }

      /* POMODORO COMPLETE MODAL */
      #pomodoro-complete-modal {
        width: 400px;
        max-height: fit-content;
      }

      .pomodoro-complete-content {
        text-align: center;
        padding: 30px;
      }

      .pomodoro-complete-icon {
        font-size: 4rem;
        margin-bottom: 20px;
      }

      .pomodoro-complete-title {
        color: var(--main-color);
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .pomodoro-complete-subtitle {
        color: #888;
        font-size: 0.9rem;
        margin-bottom: 25px;
      }

      .pomodoro-complete-stats {
        background: #0a0a0a;
        border: 1px solid #333;
        padding: 15px;
        margin-bottom: 20px;
      }

      .pomodoro-stat-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.85rem;
      }

      .pomodoro-stat-row:last-child {
        margin-bottom: 0;
      }

      .pomodoro-stat-label {
        color: #666;
      }

      .pomodoro-stat-value {
        color: var(--main-color);
      }

      .pomodoro-dismiss-btn {
        background: var(--main-color);
        color: #000;
        border: none;
        padding: 12px 40px;
        font-weight: bold;
        cursor: pointer;
        font-size: 0.9rem;
      }

      .pomodoro-dismiss-btn:hover {
        box-shadow: 0 0 20px var(--main-color);
      }

      /* POMODORO HUD (V61) */
      #pomo-hud {
        position: fixed;
        top: -160px; /* Hidden by default */
        left: 50%;
        transform: translateX(-50%);
        width: 320px;
        background: var(--bg-overlay);
        border: 1px solid var(--main-color);
        border-top: none;
        padding: 16px 20px;
        z-index: var(--z-tooltip);
        font-family: "Space Mono", monospace;
        box-shadow: 0 0 30px rgba(var(--main-color-rgb, 0, 255, 65), 0.15);
        transition: top 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        pointer-events: auto;
        cursor: pointer;
        backdrop-filter: blur(10px);
      }

      #pomo-hud.active {
        top: 0;
        animation: pomo-flicker 0.4s ease-out;
      }

      @keyframes pomo-flicker {
        0% {
          opacity: 0;
          transform: translateX(-50%) translateY(-20px) scaleY(0);
        }
        50% {
          opacity: 0.5;
          transform: translateX(-50%) translateY(0) scaleY(1.1);
        }
        70% {
          opacity: 0.8;
          transform: translateX(-50%) scaleY(0.9);
        }
        100% {
          opacity: 1;
          transform: translateX(-50%) scaleY(1);
        }
      }

      .hud-scanlines {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.05),
          rgba(0, 0, 0, 0.05) 1px,
          transparent 1px,
          transparent 2px
        );
        pointer-events: none;
      }

      .hud-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        padding-bottom: 8px;
        margin-bottom: 12px;
        font-size: 0.7rem;
        letter-spacing: 2px;
        color: var(--main-color);
        opacity: 0.8;
      }

      .hud-title {
        font-size: 0.95rem;
        font-weight: bold;
        color: var(--main-color);
        text-shadow: 0 0 10px var(--main-color);
        margin-bottom: 2px;
        letter-spacing: 1px;
      }

      .hud-subtitle {
        font-size: 0.7rem;
        color: #888;
        letter-spacing: 0.5px;
      }

      .hud-glitch-bar {
        height: 2px;
        background: var(--main-color);
        margin-top: 15px;
        width: 100%;
        transform-origin: left;
        animation: hud-bar-load 2s ease-out;
      }

      @keyframes hud-bar-load {
        0% {
          transform: scaleX(0);
        }
        100% {
          transform: scaleX(1);
        }
      }

      /* CONFIRMATION MODAL */
      /* CONFIRMATION MODAL - CRITICAL ALERT LAYER */
      #confirm-modal {
        width: fit-content;
        max-width: 90vw;
        min-width: 320px;
        z-index: var(--z-toast) !important; /* V28: STRICT HIERARCHY - TOP */
        max-height: fit-content;
        overflow-y: auto;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        background: rgba(10, 10, 15, 0.95);
        border: 1px solid var(--main-color);
        display: none;
        padding: 10px;
      }

      #confirm-modal.active {
        display: flex !important;
      }

      .confirm-content {
        padding: 25px; /* Increased padding */
        width: 100%;
        box-sizing: border-box;
      }

      /* Redundant confirm buttons removed (V63.4 handled in Level 3 section) */

      /* THEME MODAL (V17) */
      #theme-modal {
        width: 480px;
        overflow-y: auto;
        /* V19.24 */
        max-height: fit-content;
      }

      /* FOLDER CREATE MODAL (V3.9) */
      #folder-create-modal {
        width: 380px;
        height: fit-content;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        background: rgba(8, 8, 12, 0.9);
        border: 1px solid var(--main-color);
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        max-height: 90vh;
      }

      .folder-modal-body {
        padding: 25px;
      }

      .folder-modal-input {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid #333;
        color: #eee;
        padding: 12px;
        font-family: var(--secondary-font);
        font-size: 0.9rem;
        box-sizing: border-box;
        margin-top: 15px;
        outline: none;
        transition: border-color 0.2s;
      }

      /* GRAPH VIEW STYLES */
      .graph-modal {
        /* V28: Removed legacy z-index: 10005. Handled by ModalManager (21000+) */
        border: 1px solid var(--main-color);
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        background: rgba(5, 5, 8, 0.95) !important;
      }

      /* V87: Graph Mode Toggle Button */
      .graph-mode-toggle {
        background: transparent;
        border: 1px solid var(--main-color);
        color: var(--main-color);
        font-family: var(--font-main);
        font-size: 0.7rem;
        padding: 4px 12px;
        cursor: pointer;
        letter-spacing: 1px;
        text-transform: uppercase;
        transition: all 0.2s;
      }
      .graph-mode-toggle:hover {
        background: var(--main-color);
        color: #000;
      }
      .graph-mode-toggle.active {
        background: var(--main-color);
        color: #000;
        font-weight: bold;
      }

      /* V87: Active node pulse animation */
      @keyframes graphNodePulse {
        0%,
        100% {
          filter: drop-shadow(0 0 4px currentColor);
        }
        50% {
          filter: drop-shadow(0 0 12px currentColor);
        }
      }
      .graph-node-active circle {
        animation: graphNodePulse 2s ease-in-out infinite;
      }

      /* V3.9: Maximized Note Editor */
      /* V30: True Full Screen Maximize */
      .note-editor-modal.maximized {
        width: 100vw !important;
        height: 100vh !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        margin: 0 !important;
        border-radius: 0 !important;
        max-width: none !important;
        max-height: none !important;
        transform: none !important;
        z-index: var(--z-modal-maximized) !important; /* Force top layer */
      }

      /* V15.1: Ensure child modals overlap maximized editor */
      /* V28: Sanitation - Cleaned up old overrides */

      /* V58: Z-index hierarchy for modals */
      /* Level 1: Standard modals (21000) */
      /* Level 2: Notes modal maximized (25000) */
      /* Level 3: Child modals over maximized (26000) */
      #folder-create-modal.active,
      #graph-modal.active,
      #kanban-modal.active,
      #note-help-modal.active,
      #callout-modal.active,
      .confirm-modal.active {
        z-index: var(--z-modal-child) !important;
      }

      /* V61: Clean maximized footer alignment using container pseudo-element */
      .note-editor-modal.maximized .notes-container {
        height: calc(100% - 60px);
        padding-bottom: 0;
        overflow: hidden;
        display: flex;
      }

      .note-editor-modal.maximized .notes-container::after {
        display: none;
      }

      .note-editor-modal.maximized .notes-editor {
        display: flex;
        flex-direction: column;
        flex: 1;
        height: 100%;
        overflow: hidden;
      }

      .note-editor-modal.maximized .block-editor,
      .note-editor-modal.maximized .note-preview {
        flex: 1;
        /* V63.4: REMOVED display:flex - let JS control visibility via style.display */
        flex-direction: column;
        height: auto !important; /* Allow flex to take over when visible */
        overflow-y: auto;
        border-bottom: none !important;
        padding: 40px; /* More breathing room in maximized */
        box-sizing: border-box;
      }
      .note-editor-modal.maximized .editor-footer,
      .note-editor-modal.maximized .sidebar-footer {
        border-top: none !important;
        border-left: none !important;
        border-right: none !important;
      }

      /* V15.1: Block Divider Styles */
      .block-divider {
        border: none;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
        margin: 20px 0;
        width: 100%;
      }

      .note-help-modal {
        max-width: 450px !important;
        height: fit-content !important;
        z-index: var(--z-context-menu) !important; /* V36: Higher than Editor */
      }

      .graph-node {
        cursor: pointer;
        stroke: #000;
        stroke-width: 1.5px;
        transition:
          r 0.2s,
          stroke-width 0.2s;
      }

      .graph-node:hover {
        stroke-width: 3px;
      }

      .graph-link {
        /* V60: Use theme secondary color for links */
        stroke: var(--secondary-color, #ff00ff);
        stroke-opacity: 0.5;
        stroke-width: 1.5px;
        transition:
          stroke-opacity 0.2s,
          stroke-width 0.2s;
      }

      .graph-label {
        font-size: 10px;
        font-family: var(--font-secondary);
        fill: #888;
        pointer-events: none;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .graph-node.active {
        stroke: var(--main-color);
        stroke-width: 3px;
      }

      .graph-node.highlighted {
        r: 8 !important;
      }

      .graph-link.highlighted {
        stroke: var(--main-color);
        stroke-opacity: 0.8;
        stroke-width: 2px;
      }

      .graph-label.highlighted {
        fill: var(--main-color);
        font-weight: bold;
        font-size: 11px;
      }

      .graph-node.dimmed,
      .graph-link.dimmed,
      .graph-label.dimmed {
        opacity: 0.1;
      }

      .folder-modal-input:focus {
        border-color: var(--main-color);
      }

      .folder-modal-footer {
        display: flex;
        justify-content: center; /* V63.4: Center the buttons */
        gap: 10px;
        padding: 15px 25px;
        background: rgba(0, 0, 0, 0.3);
        border-top: 1px solid #222;
      }

      #theme-modal .config-input {
        width: 100%;
        box-sizing: border-box;
        max-width: 460px;
      }

      .theme-modal-content {
        padding: 20px;
      }

      .theme-modal-body {
        margin-bottom: 20px;
      }

      .theme-modal-label {
        display: block;
        color: var(--main-color);
        font-size: 0.8rem;
        margin-bottom: 8px;
        text-transform: uppercase;
      }

      .theme-modal-textarea {
        font-size: 0.75rem;
        resize: vertical;
        min-height: 120px;
        margin-top: 10px;
        font-family: "Space Mono", monospace;
        /* V19.24 */
        width: 100%;
        box-sizing: border-box;
        max-height: 400px;
      }

      .theme-modal-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }

      .confirm-btn-primary {
        background: var(--main-color);
        color: #000;
        border-color: var(--main-color);
      }

      .confirm-btn-primary:hover {
        background: #fff;
        color: #000;
      }

      .confirm-content {
        text-align: center;
        padding: 40px 30px;
      }

      .confirm-icon {
        font-size: 2.5rem;
        margin-bottom: 20px;
        color: var(--main-color);
        opacity: 0.8;
        filter: drop-shadow(0 0 10px rgba(var(--main-color-rgb), 0.3));
      }

      .confirm-title {
        color: #fff;
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 12px;
        letter-spacing: 2px;
        text-transform: uppercase;
      }

      .confirm-message {
        color: #aaa;
        font-size: 0.85rem;
        margin-bottom: 30px;
        line-height: 1.6;
        word-break: break-word;
        overflow-wrap: anywhere;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
      }

      .status-item .label {
        display: block;
        color: var(--secondary-color);
        font-size: 0.7rem;
        margin-bottom: 2px;
        font-family: var(--font-secondary);
      }

      .weather-extra-row .label {
        color: var(--secondary-color);
        font-size: 0.6rem;
        margin-bottom: 2px;
        font-family: var(--font-secondary);
      }

      /* Tree View Styles (V3.9 Refined) */
      .tree-container {
        padding-left: 5px;
        position: relative;
      }

      .tree-folder {
        position: relative;
      }

      .tree-folder-header {
        padding: 6px 5px;
        cursor: pointer;
        color: var(--secondary-color);
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 5px;
        user-select: none;
        position: relative;
        z-index: 2;
      }

      #link-popover button:hover {
        border-color: var(--main-color);
        background: rgba(0, 255, 65, 0.05);
      }

      #link-popover .remove-btn {
        background: none;
        border: none;
        color: #666;
        font-size: 0.65rem;
        cursor: pointer;
        padding: 0;
        margin-top: 10px;
        text-decoration: underline;
        text-transform: uppercase;
        width: fit-content;
      }

      #link-popover .remove-btn:hover {
        color: #ff3333;
        background: none;
        border: none;
      }

      .tree-folder-header .folder-icon {
        font-size: 0.65rem;
        width: 15px;
        text-align: center;
        color: var(--main-color);
      }

      .tree-children {
        position: relative;
        margin-left: 12px;
        padding-left: 10px;
        border-left: 1px solid #222;
        /* Dim vertical line */
      }

      .sidebar-note-item {
        position: relative;
        padding: 8px 10px 8px 15px !important;
        margin-left: 0 !important;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      }

      /* Horizontal Connectors */
      .tree-folder::before,
      .sidebar-note-item::before {
        content: "";
        position: absolute;
        left: -10px;
        top: 15px;
        /* Alignment with text center */
        width: 10px;
        height: 1px;
        background: #252525;
      }

      /* Folder Delete Button (V3.9) */
      .tree-folder-header .folder-delete-btn {
        margin-left: auto;
        color: #444;
        font-size: 0.6rem;
        opacity: 0;
        transition:
          opacity 0.2s,
          color 0.2s;
        padding: 2px 5px;
        cursor: pointer;
        z-index: 10;
      }

      .tree-folder-header:hover .folder-delete-btn {
        opacity: 1;
      }

      .tree-folder-header .folder-delete-btn:hover {
        color: #ff4d4d;
        /* Danger color */
      }

      /* Selected Note Enhancement */
      .sidebar-note-item.selected {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.15) !important;
        border-left: 3px solid var(--main-color) !important;
        box-shadow: inset 0 0 10px rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
      }

      /* Drag Over Highlights */
      .tree-folder-header.drag-over {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
        border-radius: 2px;
        outline: 1px dashed var(--main-color);
      }

      /* V65: Boards Section Styling */
      .tree-boards-section {
        margin-top: 20px;
        border-top: 1px solid rgba(0, 204, 255, 0.2);
        padding-top: 10px;
      }

      .tree-boards-header {
        color: #00ccff;
      }

      .tree-boards-header .tree-folder-icon {
        color: #00ccff;
      }

      .tree-boards-title {
        color: #00ccff !important;
      }

      .tree-boards-list {
        padding-left: 15px;
      }

      .tree-board-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 6px 10px;
        margin: 2px 0;
        border-left: 2px solid #00ccff;
        background: rgba(0, 204, 255, 0.03);
        cursor: pointer;
        transition: all 0.15s;
      }

      .tree-board-item:hover {
        background: rgba(0, 204, 255, 0.08);
        border-left-color: #00ccff;
      }

      .tree-board-label {
        flex: 1;
        font-size: 0.7rem;
        color: #888;
        letter-spacing: 0.5px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .tree-board-item:hover .tree-board-label {
        color: #00ccff;
      }

      .tree-board-delete {
        background: transparent;
        border: none;
        color: #555;
        font-size: 0.6rem;
        cursor: pointer;
        opacity: 0;
        padding: 2px 6px;
        transition: all 0.15s;
      }

      .tree-board-item:hover .tree-board-delete {
        opacity: 1;
      }

      .tree-board-delete:hover {
        color: #f55;
      }

      .tree-drop-hint {
        height: 2px;
        background: var(--main-color);
        margin: 2px 0;
        box-shadow: 0 0 5px var(--main-color);
      }

      .confirm-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .confirm-btn {
        padding: 10px 22px;
        font-family: inherit;
        font-size: 0.75rem;
        letter-spacing: 1.2px;
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
        color: #ccc;
        transition: all 0.2s;
        min-width: 130px;
        text-transform: uppercase;
      }

      .confirm-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.3);
      }

      .confirm-btn-danger {
        background: rgba(255, 0, 85, 0.1) !important;
        border-color: rgba(255, 0, 85, 0.3) !important;
        color: #ff0055 !important;
      }

      .confirm-btn-danger:hover {
        background: #ff0055 !important;
        color: #000 !important;
        border-color: #ff0055 !important;
        box-shadow: 0 0 15px rgba(255, 0, 85, 0.4);
      }

      .confirm-btn.active {
        border-color: var(--main-color);
        color: #fff;
      }

      .input-group {
        position: relative;
        width: 100%;
        max-width: 700px;
        margin: 0 auto;
      }

      .cmd-wrapper {
        display: flex;
        flex-direction: column;
        background: rgba(0, 0, 0, 0.85);
        border: 1px solid #333;
        padding: 15px 20px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      }

      .cmd-wrapper:focus-within {
        border-color: var(--main-color);
        box-shadow: 0 0 20px rgba(0, 255, 65, 0.1);
      }

      .cmd-main-row {
        display: flex;
        align-items: center;
        width: 100%;
      }

      #greeting {
        color: var(--secondary-color);
        font-size: 1.2rem;
        margin-bottom: 5px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .prompt {
        color: var(--main-color);
        font-size: 1.5rem;
        margin-right: 15px;
        font-weight: bold;
      }

      #cmd-input {
        background: transparent;
        border: none;
        color: #fff;
        font-family: "Space Mono", monospace;
        font-size: 1.4rem;
        width: 100%;
        outline: none;
      }

      #command-hint {
        display: none;
        width: 100%;
        text-align: left;
        padding-top: 10px;
        padding-left: 40px;
        font-size: 0.75rem;
        color: #555;
        border-top: 1px solid #222;
        margin-top: 10px;
      }

      .hint-syntax {
        color: var(--main-color);
      }

      #suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: #000;
        border: 1px solid var(--main-color);
        border-top: none;
        max-height: 300px;
        overflow-y: auto;
        display: none;
        text-align: left;
        z-index: 50;
      }

      .suggestion-item {
        padding: 12px 20px;
        color: #888;
        cursor: pointer;
        border-bottom: 1px solid #1a1a1a;
        font-size: 0.95rem;
        display: flex;
        justify-content: flex-start;
        gap: 15px;
        align-items: center;
      }

      .suggestion-item:hover,
      .suggestion-item.active {
        background: var(--main-color);
        color: #000;
      }

      .suggestion-item .type-badge {
        font-size: 0.65rem;
        text-transform: uppercase;
        opacity: 0.7;
        padding: 2px 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
      }

      .suggestion-item:hover .type-badge,
      .suggestion-item.active .type-badge {
        background: rgba(0, 0, 0, 0.2);
      }

      /* V18.5: Notes Panel (Quick Access) */
      #notes-panel {
        position: absolute;
        top: 100px;
        right: 30px;
        left: auto;
        width: max-content;
        max-width: 280px;
        min-width: 200px;
        max-height: 40vh;
        /* V18.4: Reduced to prevent overlap */
        overflow-y: auto;
        overflow-x: hidden;
        /* V19.34: Prevent horizontal scroll */
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid #333;
        padding: 15px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        text-align: left;
        z-index: 40;
        display: none;
      }

      /* V19.34: Fix Text Overflow */
      #notes-list {
        word-break: break-word;
        overflow-wrap: break-word;
        display: flex;
        flex-direction: column;
        gap: 0;
      }

      /* Apple Notes Style Items */
      .internal-link {
        color: #888;
        border-bottom: 1px dashed #444;
        cursor: pointer;
        transition: all 0.2s;
      }

      .external-link {
        color: var(--main-color);
        text-decoration: underline;
        opacity: 0.8;
        cursor: pointer;
      }

      .external-link:hover {
        opacity: 1;
      }

      .note-item {
        padding: 12px 5px;
        border-bottom: 1px solid #333;
        cursor: pointer;
        transition: background 0.2s;
      }

      .note-item:last-child {
        border-bottom: none;
      }

      .note-item:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .note-item-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 4px;
      }

      .note-item-title-quick {
        font-weight: bold;
        color: var(--main-color);
        font-size: 0.9rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 65%;
      }

      .note-item-meta {
        font-size: 0.65rem;
        color: #666;
        white-space: nowrap;
      }

      .note-item-teaser {
        font-size: 0.75rem;
        color: #888;
        line-height: 1.3;
        max-height: 2.6em;
        /* 2 lines */
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        text-overflow: ellipsis;
        font-family: var(--font-secondary);
      }

      /* MISSION LOG */
      #mission-log {
        position: absolute;
        top: 100px;
        left: 30px;
        right: auto;
        width: max-content;
        max-width: 280px;
        min-width: 200px;
        max-height: 30vh;
        /* V18.4: Reduced to prevent clock obstruction */
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid #333;
        padding: 15px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        text-align: left;
        z-index: 40;
        display: none;
      }

      #mission-log.active {
        display: block;
      }

      .panel-header {
        color: var(--main-color);
        border-bottom: 1px solid #333;
        padding-bottom: 8px;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 0.8rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .panel-header .panel-action {
        color: var(--secondary-color);
        cursor: pointer;
        font-size: 0.75rem;
        opacity: 0.7;
      }

      .panel-header .panel-action:hover {
        color: var(--main-color);
      }

      .mission-item {
        display: flex;
        align-items: baseline;
        gap: 8px;
        color: var(--secondary-color);
        font-size: 0.85rem;
        margin-bottom: 6px;
        padding-left: 0;
        line-height: 1.4;
        cursor: pointer;
      }

      .mission-item:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .mission-item.completed .mission-text {
        text-decoration: line-through;
        opacity: 0.5;
      }

      .task-checkbox {
        cursor: pointer;
        color: var(--warning-color);
        margin-right: 4px;
        font-weight: bold;
        transition: color 0.2s;
      }

      .task-checkbox:hover {
        color: #fff;
        text-shadow: 0 0 8px #fff;
      }

      .mission-marker {
        color: var(--main-color);
        margin-right: 5px;
        font-weight: bold;
      }

      /* V18.0: Priority Indicators */
      .priority-indicator {
        font-weight: bold;
        margin-right: 2px;
      }

      .mission-item.priority-high {
        border-left: 2px solid var(--danger-color);
        padding-left: 8px;
      }

      .mission-item.priority-medium {
        border-left: 2px solid var(--warning-color);
        padding-left: 8px;
      }

      .mission-item.priority-low {
        opacity: 0.7;
      }

      /* V18.0: Category Badge */
      .category-badge {
        font-size: 0.6rem;
        background: rgba(255, 255, 255, 0.1);
        color: var(--secondary-color);
        padding: 2px 5px;
        margin-left: 8px;
        border-radius: 3px;
      }

      /* V18.0: Progress Bar */
      .progress-container {
        width: 100%;
        max-width: 300px;
        margin: 10px auto;
        text-align: center;
      }

      .progress-outer {
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
      }

      #progress-bar {
        height: 100%;
        background: var(--main-color);
        width: 0%;
        transition: width 0.5s ease;
        box-shadow: 0 0 10px var(--main-color);
      }

      #progress-text {
        font-size: 0.65rem;
        color: var(--secondary-color);
        margin-top: 5px;
        letter-spacing: 1px;
      }

      /* V18.0: Streak Counter */
      .streak-container {
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }

      #streak-count {
        color: var(--warning-color);
        font-weight: bold;
      }

      .streak-pulse {
        animation: streakPulse 0.5s ease;
      }

      @keyframes streakPulse {
        0%,
        100% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.5);
          text-shadow: 0 0 15px var(--warning-color);
        }
      }

      .mission-time {
        color: var(--main-color);
        font-size: 0.65rem;
        display: block;
        margin-bottom: 2px;
        font-weight: bold;
      }

      /* NOTES PANEL */
      #notes-panel {
        position: absolute;
        bottom: 100px;
        right: 30px;
        top: auto;
        left: auto;
        max-height: 40vh;
        overflow-y: auto;
        max-width: 280px;
        min-width: 200px;
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid #333;
        padding: 15px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        text-align: left;
        z-index: var(--z-search);
        /* V18.9: Increased to be just below overlays */
        display: none;
      }

      .note-item {
        pointer-events: auto;
        /* Ensure clickable */
        padding: 5px;
        border-bottom: 1px solid #333;
        transition: background 0.2s;
      }

      .note-item:last-child {
        border-bottom: none;
      }

      .note-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      #notes-panel::-webkit-scrollbar {
        width: 5px;
      }

      #notes-panel::-webkit-scrollbar-thumb {
        background: var(--main-color);
        border-radius: 2px;
      }

      #notes-panel::-webkit-scrollbar-track {
        background: #0a0a0a;
      }

      #notes-panel.active {
        display: block;
      }

      /* Notes Discovery Hint (First-Time Users) */
      #notes-discovery-hint {
        position: absolute;
        top: 100px;
        right: 30px;
        width: max-content;
        max-width: 240px;
        background: rgba(0, 0, 0, 0.88);
        border: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.25);
        padding: 0;
        z-index: 40;
        display: none;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
        font-size: 0.75rem;
      }

      #notes-discovery-hint.active {
        display: block;
        animation: hintFadeIn 0.4s ease;
      }

      @keyframes hintFadeIn {
        from { opacity: 0; transform: translateY(-8px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .discovery-header {
        padding: 10px 14px;
        color: var(--main-color);
        font-weight: bold;
        font-size: 0.7rem;
        letter-spacing: 2px;
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.15);
      }

      .discovery-body {
        padding: 12px 14px;
        color: #888;
        line-height: 1.6;
        font-family: var(--font-secondary);
      }

      .discovery-cmd {
        display: inline-block;
        margin-top: 6px;
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.08);
        color: var(--main-color);
        padding: 4px 10px;
        border: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.2);
        font-family: var(--font-main);
        font-size: 0.8rem;
        letter-spacing: 1px;
      }

      .discovery-footer {
        padding: 8px 14px;
        text-align: right;
        border-top: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
      }

      .discovery-dismiss {
        color: var(--main-color);
        font-size: 0.65rem;
        cursor: pointer;
        opacity: 0.6;
        letter-spacing: 1px;
        transition: opacity 0.2s;
        font-weight: bold;
      }

      .discovery-dismiss:hover {
        opacity: 1;
      }

      /* Hide discovery hint in zen mode */
      body.zen-mode #notes-discovery-hint {
        display: none !important;
      }

      /* Phase 3: Query Blocks */
      .block-query {
        border: 1px solid #333;
        padding: 10px;
        margin: 10px 0;
      }

      .query-input {
        width: 100%;
        min-height: 60px;
        background: #1a1a1a;
        color: var(--main-color);
        border: 1px solid #333;
        padding: 8px;
        font-family: 'Space Mono', monospace;
        font-size: 12px;
        resize: vertical;
        box-sizing: border-box;
      }

      .query-input:focus {
        border-color: var(--main-color);
        outline: none;
      }

      .query-results {
        margin-top: 10px;
        padding: 10px;
        background: #0a0a0a;
        max-height: 400px;
        overflow-y: auto;
      }

      .query-list {
        list-style: none;
        padding: 0;
      }

      .query-list li {
        padding: 5px 0;
        border-bottom: 1px solid #222;
      }

      .query-list a {
        color: var(--main-color);
        text-decoration: none;
      }

      .query-list a:hover {
        text-decoration: underline;
      }

      .query-table {
        width: 100%;
        border-collapse: collapse;
      }

      .query-table th,
      .query-table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #333;
      }

      .query-table th {
        color: var(--main-color);
        font-weight: bold;
      }

      .query-empty {
        color: #555;
        text-align: center;
        padding: 20px;
      }

      /* Phase 3: Canvas Styles */
      #canvas-viewport {
        cursor: grab;
      }

      #canvas-viewport:active {
        cursor: grabbing;
      }


      .note-item {
        color: var(--secondary-color);
        font-size: 0.85rem;
        margin-bottom: 8px;
        border-left: 2px solid var(--warning-color);
        padding-left: 10px;
        line-height: 1.5;
        cursor: pointer;
      }

      .note-item:hover {
        color: #fff;
      }

      .note-item .note-time {
        color: var(--secondary-color);
        font-size: 0.7rem;
        display: block;
        opacity: 0.6;
      }

      /* DOCK */
      .dock {
        margin-top: 30px;
        display: flex;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .dock a {
        color: var(--main-color);
        text-decoration: none;
        font-size: 0.75rem;
        border: 1px solid #333;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 14px;
        transition: all 0.2s;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .dock a:hover {
        background: var(--main-color);
        color: #000;
        border-color: var(--main-color);
        box-shadow: 0 0 15px var(--main-color);
        transform: translateY(-2px);
      }

      /* BOOKMARKS BAR */
      #bookmarks-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 50px;
        background: rgba(0, 0, 0, 0.95);
        border-top: 1px solid #333;
        display: none;
        align-items: center;
        overflow-x: auto;
        white-space: nowrap;
        padding: 0 20px;
        z-index: 20;
        scrollbar-width: thin;
        scrollbar-color: var(--main-color) #000;
      }

      #bookmarks-container.active {
        display: flex;
      }

      .bm-node {
        color: #888;
        text-decoration: none;
        font-size: 0.8rem;
        margin-right: 20px;
        text-transform: uppercase;
        transition: color 0.2s;
      }

      .bm-node:hover {
        color: var(--main-color);
      }

      .bm-folder {
        color: var(--main-color);
        font-weight: bold;
        border: 1px solid #333;
        padding: 3px 10px;
        margin-right: 15px;
        cursor: pointer;
      }

      .bm-folder:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--main-color);
      }

      .nav-back {
        color: var(--danger-color);
        font-weight: bold;
        margin-right: 20px;
        cursor: pointer;
        border-right: 1px solid #333;
        padding-right: 15px;
      }

      /* HELP TABLE */
      .help-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
      }

      .help-table td {
        padding: 10px 15px;
        border-bottom: 1px solid #222;
      }

      .help-cmd {
        color: var(--main-color);
        font-weight: bold;
        white-space: nowrap;
      }

      /* WELCOME MODAL */
      #welcome-modal {
        width: 500px;
      }

      .welcome-content {
        padding: 25px;
      }

      .welcome-title {
        color: var(--main-color);
        font-size: 1.4rem;
        font-weight: bold;
        margin-bottom: 20px;
        text-align: center;
      }

      .welcome-section {
        margin-bottom: 20px;
      }

      .welcome-section-title {
        color: var(--main-color);
        font-size: 0.85rem;
        font-weight: bold;
        margin-bottom: 10px;
        text-transform: uppercase;
      }

      .welcome-list {
        color: #aaa;
        font-size: 0.8rem;
        line-height: 1.6;
      }

      .welcome-list li {
        margin-bottom: 5px;
      }

      .welcome-list code {
        background: #1a1a1a;
        padding: 2px 6px;
        color: var(--main-color);
      }

      .welcome-start-btn {
        display: block;
        width: 100%;
        background: var(--main-color);
        color: #000;
        border: none;
        padding: 15px;
        font-weight: bold;
        cursor: pointer;
        font-size: 1rem;
        margin-top: 20px;
      }

      .welcome-start-btn:hover {
        box-shadow: 0 0 20px var(--main-color);
      }

      /* KEYBOARD HINT */
      #shortcut-hint {
        position: fixed;
        bottom: 60px;
        right: 20px;
        font-size: 0.75rem;
        color: var(--secondary-color);
        z-index: 5;
        text-shadow: var(--text-shadow);
        font-family: var(--font-secondary);
      }

      #shortcut-hint kbd {
        background: rgba(0, 0, 0, 0.7);
        border: 1px solid var(--secondary-color);
        padding: 2px 6px;
        border-radius: 3px;
        margin: 0 2px;
        color: inherit;
      }

      /* =============================================
           DEDICATED NOTES
           ============================================= */
      .modal.notes-modal {
        width: 85vw;
        max-width: 1100px;
        height: 80vh;
        max-height: 900px;
        display: none;
        flex-direction: column;
        padding: 0;
        overflow: hidden;
      }

      .modal.notes-modal.active {
        display: flex;
      }

      .notes-container {
        display: flex;
        flex: 1 1 auto;
        width: 100%;
        overflow: hidden;
        min-height: 0;
      }

      /* ---- SIDEBAR ---- */
      .notes-modal .config-header {
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
      }

      .notes-sidebar {
        width: 280px;
        min-width: 220px;
        border-right: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        display: flex;
        flex-direction: column;
        background: rgba(0, 0, 0, 0.3);
        transition:
          width 0.2s ease,
          min-width 0.2s ease;
      }

      /* V57: Sidebar collapsed state */
      .notes-sidebar.collapsed {
        width: 0;
        min-width: 0;
        overflow: hidden;
        border-right: none;
      }

      .sidebar-header {
        padding: 12px;
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        display: flex;
        gap: 8px;
      }

      #notes-search {
        width: 100%;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid #222;
        color: #888;
        padding: 4px 10px;
        font-family: var(--font-secondary);
        font-size: 0.65rem;
        border-radius: 2px;
        height: 26px;
        /* V3.9: Thinner profile */
        letter-spacing: 1px;
        transition: all 0.2s ease;
      }

      #notes-search:focus {
        border-color: var(--main-color);
        outline: none;
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.05);
        color: var(--main-color);
      }

      #notes-search::placeholder {
        color: #555;
      }

      .sidebar-action-btn {
        background: transparent;
        border: 1px solid #444;
        color: var(--main-color);
        width: 32px;
        height: 32px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        border-radius: 3px;
        transition: all 0.2s;
      }

      .sidebar-action-btn:hover {
        background: var(--main-color);
        color: #000;
        border-color: var(--main-color);
      }

      #notes-list-sidebar {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 8px 0;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
      }

      /* Themed Scrollbar */
      #notes-list-sidebar::-webkit-scrollbar {
        width: 6px;
      }

      #notes-list-sidebar::-webkit-scrollbar-track {
        background: transparent;
      }

      #notes-list-sidebar::-webkit-scrollbar-thumb {
        background: var(--main-color);
        border-radius: 3px;
        opacity: 0.7;
      }

      #notes-list-sidebar::-webkit-scrollbar-thumb:hover {
        opacity: 1;
      }

      /* Sidebar Tags Section */
      .sidebar-tags-section {
        border-bottom: 1px solid #333;
        font-size: 0.7rem;
      }

      .tags-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        cursor: pointer;
        color: #666;
        user-select: none;
      }

      .tags-header:hover {
        color: var(--main-color);
      }

      /* Wiki Links */
      .internal-link {
        color: var(--main-color);
        text-decoration: underline;
        cursor: pointer;
        font-weight: bold;
        opacity: 0.8;
        transition: opacity 0.2s;
      }

      .internal-link:hover {
        opacity: 1;
      }

      /* Backlinks Section - V63.5: Enhanced Terminal Style */
      .backlinks-section {
        margin-top: 48px;
        padding: 16px 20px;
        border: 1px dashed rgba(var(--main-color-rgb, 0, 255, 65), 0.2);
        border-radius: 4px;
        background: rgba(0, 0, 0, 0.2);
        font-size: 0.85rem;
      }

      .backlinks-title {
        font-weight: 500;
        margin-bottom: 12px;
        color: #666;
        text-transform: uppercase;
        font-size: 0.7rem;
        letter-spacing: 2px;
      }

      .backlink-item {
        padding: 6px 10px;
        margin: 4px 0;
        cursor: pointer;
        color: var(--main-color);
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.05);
        border-left: 2px solid var(--main-color);
        transition: all 0.15s ease;
        font-family: var(--font-primary);
        font-size: 0.8rem;
      }

      .backlink-item:hover {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.12);
        padding-left: 14px;
      }

      .tags-toggle {
        transition: transform 0.2s;
      }

      .sidebar-tags-section.collapsed .tags-toggle {
        transform: rotate(-90deg);
      }

      /* V61: Prevent layout shifts between modes */
      .block-editor,
      .note-preview {
        scrollbar-gutter: stable;
        overflow-y: scroll !important; /* Force scrollbar background to stay layout-neutral */
      }

      .sidebar-tags-section.collapsed .sidebar-all-tags {
        display: none;
      }

      .sidebar-all-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        padding: 0 12px 10px 12px;
      }

      .sidebar-all-tags .tag {
        font-size: 0.65rem;
      }

      /* Pin Icon */
      .pin-icon {
        color: var(--main-color);
        font-size: 0.65rem;
        font-weight: bold;
      }

      /* Editor Scrollbar */
      #active-note-content::-webkit-scrollbar {
        width: 6px;
      }

      #active-note-content::-webkit-scrollbar-track {
        background: transparent;
      }

      #active-note-content::-webkit-scrollbar-thumb {
        background: var(--main-color);
        border-radius: 3px;
      }

      .note-preview::-webkit-scrollbar {
        width: 6px;
      }

      .note-preview::-webkit-scrollbar-track {
        background: transparent;
      }

      .note-preview::-webkit-scrollbar-thumb {
        background: var(--main-color);
        border-radius: 3px;
      }

      /* Sidebar Footer */
      /* Sidebar Footer */
      .sidebar-footer {
        padding: 10px 12px;
        border-top: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        display: flex;
        justify-content: space-between;
        gap: 8px;
        min-height: 57px;
        /* Matches editor footer (36px min + 20px padding approx) - explicit alignment */
        height: 57px;
        box-sizing: border-box;
        align-items: center;
      }

      /* Removed individual maximized footer border in favor of container pseudo-element */

      .sidebar-footer .text-btn {
        flex: 1;
        font-size: 0.65rem;
        padding: 6px 10px;
      }

      /* Multi-select Checkbox */
      .note-checkbox {
        color: #666;
        font-size: 0.7rem;
        font-family: var(--font-primary);
      }

      .note-checkbox.checked {
        color: var(--main-color);
      }

      .sidebar-note-item.selected {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.15);
        border-left-color: var(--main-color);
      }

      /* Sidebar Note Items - Obsidian Style */
      .sidebar-note-item {
        padding: 12px 16px;
        cursor: pointer;
        border-left: 3px solid transparent;
        margin: 2px 8px;
        border-radius: 4px;
        transition: all 0.15s ease;
      }

      .sidebar-note-item:hover {
        background: rgba(255, 255, 255, 0.05);
        border-left-color: #555;
      }

      .sidebar-note-item.active {
        background: rgba(255, 255, 255, 0.08);
        border-left-color: var(--main-color);
      }

      .sidebar-note-item.active .note-item-title {
        color: var(--main-color);
      }

      .note-item-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #ddd;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 4px;
      }

      .note-item-preview {
        font-size: 0.75rem;
        color: #666;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 4px;
      }

      .note-item-date {
        font-size: 0.65rem;
        color: #555;
      }

      /* ---- EDITOR ---- */
      .notes-editor {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: rgba(0, 0, 0, 0.15);
        min-width: 0;
        min-height: 0;
        /* Critical for flex shrinking */
      }

      /* V63.2: Tab Bar */
      .editor-tab-bar {
        display: flex;
        align-items: center;
        padding: 4px 8px;
        background: rgba(0, 0, 0, 0.2);
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.2);
        gap: 4px;
        min-height: 32px;
      }

      .tab-nav {
        display: flex;
        gap: 2px;
      }

      .tab-nav-btn {
        background: transparent;
        border: none;
        color: #666;
        font-size: 1.2rem;
        padding: 2px 6px;
        cursor: pointer;
        transition: color 0.15s;
      }

      .tab-nav-btn:hover {
        color: var(--main-color);
      }

      .tabs-container {
        display: flex;
        flex: 1;
        gap: 2px;
        overflow-x: auto;
        scrollbar-width: none;
      }

      .tabs-container::-webkit-scrollbar {
        display: none;
      }

      .tab-item {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid transparent;
        border-radius: 4px 4px 0 0;
        color: #888;
        font-size: 0.75rem;
        font-family: var(--font-primary);
        cursor: pointer;
        transition: all 0.15s;
        width: 140px; /* V63.5: Fixed width for consistent UI */
        flex-shrink: 0;
      }

      .tab-title {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .tab-item:hover {
        background: rgba(255, 255, 255, 0.06);
        color: #ccc;
      }

      .tab-item.active {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
        border-color: rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        color: var(--main-color);
      }

      .tab-close {
        opacity: 0;
        padding: 0 2px;
        font-size: 0.65rem;
        transition: opacity 0.15s;
      }

      .tab-item:hover .tab-close,
      .tab-item.active .tab-close {
        opacity: 0.6;
      }

      .tab-close:hover {
        opacity: 1 !important;
        color: #ff5555;
      }

      .tab-new-btn {
        background: transparent;
        border: none;
        color: #666;
        font-size: 1rem;
        padding: 4px 8px;
        cursor: pointer;
        transition: color 0.15s;
      }

      .tab-new-btn:hover {
        color: var(--main-color);
      }

      /* V63.2: Slimmer Header */
      .editor-header {
        padding: 8px 16px;
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .editor-header-left {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
        min-width: 0;
      }

      .note-path {
        font-size: 0.65rem;
        color: #555;
        font-family: var(--font-primary);
        white-space: nowrap;
      }

      /* V63.2: Page Actions Menu */
      .page-actions-trigger {
        font-size: 0.9rem;
        letter-spacing: 1px;
      }

      /* V63.2 FIX: Position relative on editor-header-right for menu anchoring */
      .editor-header-right {
        position: relative;
      }

      .page-actions-menu {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 4px;
        width: 220px;
        background: rgba(10, 10, 12, 0.95);
        border: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        border-radius: 6px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        z-index: var(--z-modal-child);
        font-family: var(--font-primary);
        font-size: 0.8rem;
        overflow: hidden;
        backdrop-filter: blur(10px);
      }

      .page-actions-menu.active {
        display: block;
      }

      .page-actions-search {
        width: 100%;
        padding: 10px 12px;
        background: transparent;
        border: none;
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.2);
        color: #ccc;
        font-family: var(--font-primary);
        font-size: 0.8rem;
        outline: none;
      }

      .page-actions-search::placeholder {
        color: #555;
      }

      .page-actions-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .page-action-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        cursor: pointer;
        transition: background 0.15s;
      }

      .page-action-item:hover,
      .page-action-item.highlighted {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
      }

      .page-action-item kbd {
        font-size: 0.65rem;
        color: #666;
      }

      .page-action-item.danger {
        color: #ff5555;
      }

      .page-action-item.danger:hover {
        background: rgba(255, 85, 85, 0.15);
      }

      .page-action-divider {
        height: 1px;
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
        margin: 4px 0;
      }

      /* V63.2: Page Actions Footer */
      .page-actions-footer {
        padding: 10px 12px;
        border-top: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
        font-size: 0.7rem;
        color: #666;
        display: flex;
        justify-content: space-between;
      }

      /* V63.2: Tags Bar (replaces footer) */
      .editor-tags-bar {
        padding: 6px 16px;
        min-height: 28px;
        display: flex;
        align-items: center;
        gap: 6px;
        border: none;
      }

      /* V63.2: Editable Path Input - V65 widened */
      .note-path-input {
        background: transparent;
        border: none;
        color: #555;
        font-size: 0.65rem;
        font-family: var(--font-primary);
        width: 200px;
        min-width: 160px;
        padding: 2px 4px;
        outline: none;
      }

      .note-path-input:focus {
        color: #888;
        border-bottom: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
      }

      /* V65: Title uses flex to share space with path input */
      #active-note-title {
        background: transparent;
        border: none;
        border-bottom: 1px solid transparent;
        color: var(--main-color);
        font-family: var(--font-secondary);
        font-size: 1.4rem;
        font-weight: bold;
        flex: 1;
        min-width: 100px;
        max-width: calc(100% - 220px);
        padding: 4px 0;
        outline: none;
        transition: border-color 0.2s;
      }

      #active-note-title:focus {
        border-bottom-color: var(--main-color);
      }

      #active-note-title::placeholder {
        color: #555;
        font-weight: normal;
      }

      .editor-header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      #preview-toggle {
        padding: 4px 10px;
        font-size: 0.7rem;
        border: 1px solid #444;
        border-radius: 3px;
      }

      #preview-toggle.active {
        background: var(--main-color);
        color: #000;
        border-color: var(--main-color);
      }

      #note-timestamp {
        font-size: 0.7rem;
        color: #555;
        font-family: var(--font-secondary);
      }

      #active-note-content {
        flex: 1;
        width: 100%;
        background: transparent;
        border: none;
        color: #ccc;
        padding: 20px 24px;
        font-family: var(--font-secondary);
        font-size: 1rem;
        resize: none;
        outline: none;
        line-height: 1.8;
      }

      /* V63.4: Weather Loading Animation */
      @keyframes weatherPulse {
        0% {
          opacity: 0.5;
          transform: scale(0.95);
        }
        50% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0.5;
          transform: scale(0.95);
        }
      }
      .weather-loading {
        animation: weatherPulse 1.5s infinite ease-in-out;
        color: var(--main-color) !important;
        letter-spacing: 2px;
      }
      .weather-error {
        color: #ff4444 !important;
        font-size: 0.7rem;
      }

      .note-preview {
        display: none;
        flex: 1;
        width: 100%;
        padding: 20px 52px; /* V63.4: Aligned with Block Editor (24px + 28px) */
        overflow-y: auto;
        color: #ccc;
        font-family: var(--font-secondary);
        font-size: 1rem;
        line-height: 1.4; /* V63: Slightly tighter than 1.6 */
      }

      .note-preview.active {
        display: block;
      }

      .note-preview h1,
      .note-preview h2,
      .note-preview h3 {
        color: var(--main-color);
        margin: 0 0 6px 0; /* V82: Match Editor .block-wrapper margin */
        padding: 0;
        font-weight: bold;
        line-height: 1.2;
      }

      /* V82: Strict Parity with Editor (6px Spacing) */
      .note-preview p {
        margin: 0 0 6px 0;
        line-height: 1.5;
      }

      .note-preview ul,
      .note-preview ol,
      .note-preview blockquote {
        margin: 0 0 6px 0;
      }

      .note-preview h1 {
        font-size: 1.8rem; /* V50: Match .block-h1 */
      }

      .note-preview h2 {
        font-size: 1.4rem; /* V50: Match .block-h2 */
      }

      .note-preview h3 {
        font-size: 1.1rem; /* V50: Match .block-h3 */
      }

      .note-preview code {
        background: rgba(255, 255, 255, 0.1);
        padding: 2px 6px;
        border-radius: 3px;
        font-family: var(--font-primary);
      }

      #note-tags {
        display: flex;
        gap: 6px;
        margin-left: 12px;
      }

      .tag {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.15);
        color: var(--main-color);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.6rem;
        cursor: pointer;
      }

      .tag:hover {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.25);
      }

      .tag.active {
        background: var(--main-color);
        color: #000;
      }

      /* V63.6: Markdown Table Styles (Preview Mode) */
      .markdown-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        font-size: 0.85rem;
        border: 1px solid #444;
        table-layout: fixed;
      }
      .markdown-table th {
        background: rgba(255, 255, 255, 0.08);
        color: var(--main-color);
        padding: 10px 12px;
        text-align: left;
        border: 1px solid #444;
        text-transform: uppercase;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.5px;
      }
      .markdown-table td {
        padding: 10px 12px;
        border: 1px solid #444;
        color: #ccc;
        min-height: 20px;
        min-width: 80px;
      }
      .markdown-table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.02);
      }

      /* V64: WYSIWYG Table Editor Styles */
      .block-table {
        position: relative;
        margin: 15px 0;
        padding: 10px 0;
      }
      .table-wrapper {
        position: relative;
        overflow-x: auto;
      }
      .table-grid {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
        border: 1px solid #444;
        table-layout: fixed;
      }
      .table-grid th,
      .table-grid td {
        border: 1px solid #444;
        padding: 0;
        min-width: 100px;
        position: relative;
      }
      .table-grid th {
        background: rgba(255, 255, 255, 0.08);
      }
      .table-cell {
        display: block;
        padding: 10px 12px;
        min-height: 20px;
        outline: none;
        color: #ccc;
        cursor: text;
      }
      .table-header-cell {
        color: var(--main-color);
        text-transform: uppercase;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.5px;
      }
      .table-cell:focus {
        background: rgba(100, 180, 255, 0.08);
        box-shadow: inset 0 0 0 2px var(--main-color);
      }
      .table-cell:empty::before {
        content: "";
        color: #555;
      }

      /* Row Controls */
      .table-row-controls {
        position: absolute;
        left: -30px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        opacity: 0;
        transition: opacity 0.15s;
      }
      .table-grid tr:hover .table-row-controls {
        opacity: 1;
      }
      .table-row-handle {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #666;
        font-size: 0.7rem;
        border-radius: 3px;
      }
      .table-row-handle:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #aaa;
      }

      /* Add Row Button */
      .table-add-row-btn {
        display: block;
        width: 100%;
        padding: 6px;
        margin-top: 4px;
        background: transparent;
        border: 1px dashed #444;
        color: #666;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        transition: all 0.15s;
        opacity: 0;
      }
      .block-table:hover .table-add-row-btn {
        opacity: 1;
      }
      .table-add-row-btn:hover {
        border-color: var(--main-color);
        color: var(--main-color);
        background: rgba(100, 180, 255, 0.05);
      }

      /* Add Column Button */
      .table-add-col-btn {
        position: absolute;
        right: -28px;
        top: 50%;
        transform: translateY(-50%);
        width: 24px;
        height: 60px;
        background: transparent;
        border: 1px dashed #444;
        color: #666;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.15s;
        opacity: 0;
        border-radius: 3px;
      }
      .block-table:hover .table-add-col-btn {
        opacity: 1;
      }
      .table-add-col-btn:hover {
        border-color: var(--main-color);
        color: var(--main-color);
        background: rgba(100, 180, 255, 0.05);
      }

      /* Column Header Controls */
      .table-col-controls {
        position: absolute;
        top: -24px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 4px;
        opacity: 0;
        transition: opacity 0.15s;
      }
      .table-grid th:hover .table-col-controls {
        opacity: 1;
      }
      .table-col-btn {
        width: 18px;
        height: 18px;
        background: #222;
        border: 1px solid #444;
        color: #888;
        font-size: 0.6rem;
        cursor: pointer;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .table-col-btn:hover {
        border-color: #f44;
        color: #f44;
      }

      /* Table Toolbar */
      .table-toolbar {
        position: absolute;
        top: -40px;
        left: 0;
        display: flex;
        gap: 2px;
        background: #1a1a1a;
        border: 1px solid #444;
        border-radius: 6px;
        padding: 4px 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        z-index: 100;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.15s;
      }
      .table-toolbar.visible {
        opacity: 1;
        pointer-events: auto;
      }
      .table-toolbar-btn {
        padding: 6px 10px;
        background: transparent;
        border: none;
        color: #888;
        font-size: 0.7rem;
        cursor: pointer;
        border-radius: 4px;
        white-space: nowrap;
        transition: all 0.1s;
      }
      .table-toolbar-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
      }
      .table-toolbar-btn.active {
        background: var(--main-color);
        color: #000;
      }
      .table-toolbar-divider {
        width: 1px;
        background: #444;
        margin: 0 4px;
      }

      /* Delete Row Button (in-row) */
      .table-delete-row-btn {
        position: absolute;
        right: -24px;
        top: 50%;
        transform: translateY(-50%);
        width: 18px;
        height: 18px;
        background: transparent;
        border: 1px solid transparent;
        color: #555;
        font-size: 0.6rem;
        cursor: pointer;
        opacity: 0;
        transition: all 0.15s;
        border-radius: 3px;
      }
      .table-grid tr:hover .table-delete-row-btn {
        opacity: 1;
      }
      .table-delete-row-btn:hover {
        border-color: #f44;
        color: #f44;
        background: rgba(244, 68, 68, 0.1);
      }

      /* V63.6: Preview Image Styles */
      .preview-image-container {
        margin: 15px 0;
        text-align: center;
      }
      .preview-img {
        max-width: 100%;
        max-height: 500px;
        border-radius: 4px;
        border: 1px solid #333;
      }
      .preview-image-caption {
        font-size: 0.75rem;
        color: #666;
        margin-top: 8px;
        font-style: italic;
      }

      #active-note-content::placeholder {
        color: #444;
      }

      /* ---- STATUS BAR ---- */
      /* ---- STATUS BAR ---- */
      .editor-footer {
        padding: 10px 24px;
        border-top: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        background: rgba(0, 0, 0, 0.3);
        height: 57px;
        /* Matched to sidebar footer */
        min-height: 57px;
        box-sizing: border-box;
      }

      .status-left {
        display: flex;
        gap: 16px;
        color: #555;
      }

      .status-right {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      #word-count {
        color: #555;
      }

      #save-status {
        color: #555;
        transition: color 0.3s;
      }

      #save-status.saving {
        color: var(--main-color);
      }

      #save-status.saved {
        color: #4a4;
      }

      .text-btn {
        background: transparent;
        border: 1px solid transparent;
        cursor: pointer;
        padding: 4px 8px;
        font-size: 0.7rem;
        color: #888;
        transition: all 0.2s;
      }

      .text-btn:hover {
        color: #ccc;
        border-color: #555;
      }

      .danger-btn {
        color: #a55;
      }

      .danger-btn:hover {
        color: #f66;
        border-color: #a55;
      }

      /* RESPONSIVE */
      @media (max-width: 1100px) {
        #weather-widget {
          top: 20px;
          right: 20px;
          transform: scale(0.85);
          transform-origin: top right;
        }

        #mission-log {
          max-width: 200px;
          font-size: 0.75rem;
        }

        #notes-panel {
          max-width: 200px;
          font-size: 0.75rem;
        }

        .hud-container {
          width: 92%;
        }

        #clock {
          font-size: 4.5rem;
        }
      }

      @media (max-width: 800px) {
        /* Stack panels vertically on narrow screens */
        #mission-log {
          position: fixed;
          top: 70px;
          bottom: auto;
          left: 10px;
          right: 10px;
          width: auto;
          max-width: none;
          transform: none;
          max-height: 15vh;
          /* V18.5: Further reduced */
          overflow-y: auto;
          font-size: 0.7rem;
          z-index: 100 !important;
          background: rgba(0, 0, 0, 0.95);
          display: block !important;
        }

        #mission-log:not(.active) {
          display: none !important;
        }

        #mission-log.active {
          display: block !important;
        }

        /* Ensure text wraps correctly in narrow view */
        #mission-log .mission-text {
          white-space: normal;
          word-break: break-word;
        }

        /* V18.7: Notes panel matches Tasks panel styling */
        #notes-panel {
          position: fixed;
          bottom: 60px;
          left: 10px;
          right: 10px;
          width: auto;
          max-width: none;
          transform: none;
          max-height: 18vh;
          overflow-y: auto;
          font-size: 0.7rem;
          z-index: 100 !important;
          background: rgba(0, 0, 0, 0.95);
        }

        #weather-widget {
          display: none !important;
        }

        #clock {
          font-size: 3.5rem;
        }

        #greeting {
          font-size: 0.8rem;
        }

        .hud-container {
          top: 45%;
          /* Move HUD back up to center/upper-center */
          padding-top: 0;
        }

        #pomodoro-container {
          transform: scale(0.85);
        }
      }

      @media (max-width: 500px) {
        /* Very narrow - single column layout */
        #mission-log,
        #notes-panel {
          position: fixed;
          left: 10px;
          right: 10px;
          max-width: none;
          width: calc(100% - 20px);
        }

        #mission-log {
          top: 70px;
          /* Keep at top */
          bottom: auto;
          /* Override previous bottom: 200px */
          max-height: 15vh;
          /* V18.8: Strict height limit to avoid clock */
        }

        #mission-log::-webkit-scrollbar {
          display: block !important;
          /* Force scrollbar */
        }

        /* V18.7: Notes panel matches Tasks panel in very narrow viewport */
        #notes-panel {
          bottom: 85px;
          /* V18.8: Raised higher to clear shortcut hint + dock */
          left: 10px;
          right: 10px;
          width: auto;
          max-width: none;
          transform: none;
          max-height: 18vh;
        }

        #clock {
          font-size: 2.8rem;
        }

        .hud-container {
          top: 45%;
        }

        #status-bar {
          font-size: 0.6rem;
          flex-wrap: wrap;
          gap: 10px;
        }

        .dock a {
          font-size: 0.6rem;
          padding: 6px 8px;
        }

        #pomodoro-container {
          transform: scale(0.75);
        }

        .progress-container {
          max-width: 200px;
        }

        /* V18.6: Responsive modals for narrow viewports */
        .modal {
          width: 95vw;
          max-height: 85vh;
          font-size: 0.85rem;
        }

        .config-header {
          font-size: 0.9rem;
          padding: 12px;
        }

        .config-row,
        .toggle-row,
        .slider-row {
          flex-direction: column;
        }
        .config-input,
        .config-select {
          width: 100%;
        }
      }
      /* =========================================
           PHASE 3: BLOCK EDITOR STYLES
           ========================================= */
      .block-editor {
        flex: 1; /* V48: Match note-preview layout */
        padding: 20px 52px; /* V69: Updated per user request */
        min-height: 100px; /* V44: Reduced from 300px */
        outline: none;
        font-family: var(--font-secondary);
        overflow-y: auto;
        position: relative; /* V65: Required for selection box positioning */
        overflow-y: auto;
        position: relative; /* V65: Required for selection box positioning */
      }

      /* V44: Task text sizing in Editor mode */
      .task-text {
        font-size: 1rem;
        flex: 1;
      }

      /* Hide placeholder when text exists */
      .block-editor:empty:before {
        content: attr(data-placeholder);
        color: #444;
        font-style: italic;
        pointer-events: none;
      }

      /* V78: FLEXBOX ALIGNMENT SYSTEM (Strict Preview Match) */

      /* 1. The Wrapper is a Row */
      .block-wrapper {
        display: flex; /* Key change */
        flex-direction: row;
        align-items: flex-start; /* Top align */
        margin-bottom: 6px;
        border-left: 2px solid transparent;
        padding-left: 28px; /* For drag handle */
        position: relative;
        transition: all 0.2s;
        width: 100%;
      }



      /* 2. Drag Handle  fades in on hover */
      .block-drag-handle {
        position: absolute;
        left: 4px;
        top: 0;
        width: 20px;
        height: 100%;
        cursor: grab;
        opacity: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #555;
        font-size: 0.85rem;
        transition: opacity 0.15s;
        user-select: none;
        z-index: 1;
      }
      .block-drag-handle::before {
        content: "";
      }
      .block-wrapper:hover .block-drag-handle {
        opacity: 1;
      }

      /* Drag Target Indicator */
      .block-wrapper.drag-over {
        border-top: 2px solid var(--main-color);
      }

      /* Multi-Block Selection */
      .block-wrapper.block-selected {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.06);
        border-left: 2px solid var(--main-color);
      }

      /* V88: Flash on Reorder / Type Change */
      @keyframes blockFlash {
        0% {
          background: rgba(255, 215, 0, 0.15);
        }
        100% {
          background: transparent;
        }
      }
      .block-wrapper.block-flash {
        animation: blockFlash 0.45s ease-out;
      }

      /* Selection Box (rubber-band style) */
      .block-selection-box {
        position: absolute;
        border: 1px dashed var(--main-color);
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.04);
        pointer-events: none;
        z-index: 10;
      }
      /* 3. The Content determines width */
      .block-content {
        width: 100%; /* Default: span full width */
        outline: none;
        color: #ddd;
        word-wrap: break-word; /* V49: Force wrap for long lines */
        overflow-wrap: break-word;
        white-space: pre-wrap;
        min-height: 1.2rem;

        text-align: left;
      }

      /* V108: Explicitly reset/standardize Typography tags to prevent User-Agent margin bloat */
      .block-h1, .block-h2, .block-h3 {
        color: var(--main-color);
        margin: 0; /* Wrapper handles the 6px margin-bottom */
        padding: 0;
        font-weight: bold;
        line-height: 1.2;
      }
      .block-h1 { font-size: 1.8rem; }
      .block-h2 { font-size: 1.4rem; }
      .block-h3 { font-size: 1.1rem; }
      
      .block-p {
        margin: 0;
        line-height: 1.5;
      }

      /* 4. Alignment Variants (driven by data-align on wrapper) */

      /* LEFT (Default) */
      .block-wrapper[data-align="left"] {
        justify-content: flex-start;
      }
      .block-wrapper[data-align="left"] .block-content {
        width: 100%;
        text-align: left;
      }

      /* CENTER */
      .block-wrapper[data-align="center"] {
        justify-content: center;
      }
      .block-wrapper[data-align="center"] .block-content {
        width: auto; /* Shrink to fit */
        max-width: 100%;
        text-align: center; /* Inner text centered */
        position: relative;
        /* Flex item behavior automatically keeps it centered */
      }

      /* RIGHT */
      .block-wrapper[data-align="right"] {
        justify-content: flex-end;
      }
      .block-wrapper[data-align="right"] .block-content {
        width: auto;
        max-width: 100%;
        text-align: right;
        position: relative;
      }

      /* 5. SPECIFIC BLOCK TYPES with MARKERS (Bullet, Number, Task, Quote) */

      /* Bullets & Numbers: We use ::before on content to keep valid HTML/Editable */

      /* Marker Logic: Always Absolute relative to Content Block?
           If Content is "My Text" (width: 50px).
           Center Align -> Content is in center. 
           Marker needs to be to left of Content.
           Absolute left: -20px works perfectly if Content has position: relative.
        */

      /* Bullet Styles */
      .block-wrapper[data-block-type="bullet"] .block-content {
        position: relative;
        margin-left: 24px; /* V107: Push content right to prevent bullet overlapping Drag Handle */
      }
      .block-wrapper[data-block-type="bullet"] .block-content::before {
        content: "\2022";
        position: absolute;
        left: -18px;
        top: 0;
        width: 18px;
        text-align: center; /* Bullet itself centered in its slot */
        color: var(--main-color);
        font-weight: bold;
      }

      .block-wrapper[data-block-type="numbered"] .block-content {
        position: relative;
        margin-left: 24px; /* V107: Push content right to prevent number overlapping Drag Handle */
      }
      /* Only show number if data-number is present on wrapper */
      .block-wrapper[data-block-type="numbered"][data-number]
        .block-content::before {
        content: attr(data-number) "."; /* JS-driven smart numbering */
        position: absolute;
        left: -28px;
        top: 0;
        width: 24px;
        text-align: right;
        padding-right: 4px;
        color: var(--main-color);
        font-size: 0.8rem;
      }

      /* Quote Styles */
      .block-wrapper[data-block-type="quote"] .block-content {
        border-left: 3px solid var(--dim-color);
        padding: 8px 15px;
        background: rgba(255, 255, 255, 0.03);
        font-style: italic;
        color: #999;
        margin: 0; /* Let flex handle spacing */
        /* Border sticks to content box */
      }

      /* Quote Alignment Override: Center/Right shouldn't have full width */
      .block-wrapper[data-block-type="quote"][data-align="center"]
        .block-content,
      .block-wrapper[data-block-type="quote"][data-align="right"]
        .block-content {
        /* width: auto from above applies */
        text-align: inherit;
      }

      /* 6. TASKS (Checkboxes) */
      /* Structure: .block-content > [input][div.task-text] */
      .block-wrapper[data-block-type="task"] .block-content {
        display: flex;
        align-items: flex-start;
        gap: 10px;
      }

      .task-checkbox-inline {
        flex-shrink: 0;
        margin-top: 4px; /* Align with text top line */
        width: 16px;
        height: 16px;
        /* Custom Appearance for consistency */
        appearance: none;
        -webkit-appearance: none;
        border: 1px solid var(--main-color);
        border-radius: 2px;
        cursor: pointer;
        position: relative;
      }

      .task-checkbox-inline:checked {
        background: var(--main-color);
      }
      .task-checkbox-inline:checked::after {
        content: "\2713"; /* Checkmark */
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #000;
        font-size: 10px;
        font-weight: bold;
      }

      .task-text {
        /* Inner text alignment */
        text-align: inherit;
      }

      .task-item.completed span {
        text-decoration: line-through;
        opacity: 0.5;
      }

      .block-code {
        background: #0a0a0a;
        border: 1px solid #1a1a1a;
        border-radius: 4px;
        padding: 16px;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.85rem;
        position: relative;
        margin: 10px 0;
        overflow-x: auto;
        white-space: pre-wrap; /* V46: Preserve line breaks */
        line-height: 1.5;
        color: #ddd;
      }

      /* V49: Override .note-preview code for code block contents */
      .block-code code,
      .block-code .code-inner {
        background: transparent;
        padding: 0;
        border-radius: 0;
        font-family: "JetBrains Mono", monospace;
        font-size: inherit;
        color: inherit;
        white-space: pre-wrap;
        display: block;
      }

      .code-lang-label {
        position: absolute;
        top: 4px;
        right: 10px;
        font-size: 0.6rem;
        color: #444;
        text-transform: uppercase;
        letter-spacing: 1px;
        pointer-events: none;
      }

      .block-divider {
        border: none;
        border-top: 1px dashed #666; /* V90: Brightened for visibility */
        margin: 24px 0;
        flex: 1;
        width: auto; /* V91: Let flex handle width so button sits next to it */
      }

      /* V43: Divider wrapper and delete button */
      .block-divider-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        flex: 1; /* V90: Allow wrapper to expand in parent flex container */
        width: 100%; /* V90: Force full width */
      }
      .divider-delete-btn {
        position: relative; /* V91: No longer absolute */
        background: transparent;
        border: 1px solid var(--dim-color);
        color: var(--dim-color);
        font-size: 0.6rem;
        padding: 2px 6px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.2s;
      }
      .block-divider-wrapper:hover .divider-delete-btn {
        opacity: 1;
      }
      .divider-delete-btn:hover {
        border-color: #f44;
        color: #f44;
      }

      /* V63.6: Image block and delete button (matches Divider edge-alignment to avoid overlap) */
      .block-image {
        position: relative;
        margin: 20px 0;
        text-align: center;
        display: block !important;
      }
      .image-inner-wrapper {
        display: inline-block;
        max-width: 100%;
      }
      .image-delete-btn {
        position: absolute;
        top: 50%;
        right: 0;
        transform: translateY(-50%);
        background: transparent;
        border: 1px solid var(--dim-color);
        color: var(--dim-color);
        font-size: 0.6rem;
        padding: 2px 6px;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s;
        z-index: 10;
      }
      .block-image:hover .image-delete-btn {
        opacity: 1;
      }
      .image-delete-btn:hover {
        border-color: #f44;
        color: #f44;
        background: rgba(244, 68, 68, 0.1);
        transform: translateY(-50%) scale(1.1);
      }
      /* V63.6: Image caption - single line only */
      .image-caption {
        display: block;
        text-align: center;
        color: var(--dim-color);
        font-size: 0.85rem;
        font-style: italic;
        margin-top: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* V43: Code block inner element for focus */
      .code-inner {
        display: block;
        width: 100%;
        min-height: 40px;
        outline: none;
        cursor: text;
      }

      .block-kanban-ref {
        background: rgba(0, 255, 65, 0.03);
        border: 1px dashed #333;
        padding: 18px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.2s;
        margin: 10px 0;
        user-select: none;
      }

      .block-kanban-ref:hover {
        background: rgba(0, 255, 65, 0.08);
        border-color: var(--main-color);
        transform: translateY(-1px);
      }

      .block-kanban-ref .kanban-embed-icon {
        font-size: 1.2rem;
        color: var(--main-color);
      }

      .block-kanban-ref .kanban-embed-title {
        font-weight: bold;
        letter-spacing: 1px;
        color: #aaa;
      }

      /* V65: Pipeline HUD Pivot Design - Compacted */
      .block-kanban-ref {
        font-family: var(--font-primary) !important;
        background: rgba(0, 204, 255, 0.02) !important;
        border: 1px solid rgba(0, 204, 255, 0.1) !important;
        padding: 8px 12px !important; /* V65: tighter padding */
        position: relative;
        transition: all 0.2s;
      }

      .block-kanban-ref:hover {
        background: rgba(0, 204, 255, 0.04) !important;
        border-color: rgba(0, 204, 255, 0.2) !important;
      }

      .kanban-embed-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px; /* V65: tighter margin */
      }

      .kanban-embed-icon {
        color: #00ccff;
        font-weight: bold;
      }

      .kanban-embed-title {
        font-size: 0.75rem;
        color: #00ccff !important;
        letter-spacing: 2px;
        font-weight: bold;
      }

      /* V65: Pipeline HUD Active Column List */
      .kanban-hud-pipeline {
        list-style: none;
        padding: 0;
        margin: 4px 0 8px 0; /* V65: tighter margin */
        border-left: 1px dashed rgba(0, 204, 255, 0.3);
        padding-left: 12px;
      }

      .kanban-hud-item {
        font-size: 0.7rem;
        color: #888;
        margin-bottom: 2px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .kanban-hud-item.clickable {
        cursor: pointer;
        transition: all 0.2s;
      }

      .kanban-hud-item.clickable:hover {
        color: #00ccff;
        background: rgba(0, 204, 255, 0.05);
      }

      .kanban-hud-item::before {
        content: ">";
        color: #00ccff;
        font-size: 0.6rem;
      }

      /* V65: Quick Injection Bar */
      .kanban-hud-input-wrap {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 2px 8px;
        border-radius: 2px;
      }

      .kanban-hud-input {
        background: transparent;
        border: none;
        color: var(--main-color);
        font-family: var(--font-primary);
        font-size: 0.65rem;
        flex: 1;
        outline: none;
      }

      .kanban-hud-input::placeholder {
        color: #444;
      }

      /* V65: Segmented Progress Bar */
      .kanban-hud-telemetry {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 8px; /* V65: tighter margin */
        font-size: 0.6rem;
        color: #555;
      }

      .kanban-hud-progressbar {
        flex: 1;
        height: 4px;
        background: rgba(255, 255, 255, 0.05);
        display: flex;
        gap: 2px;
      }

      .kanban-hud-segment {
        height: 100%;
        background: #222;
        flex: 1;
      }

      .kanban-hud-segment.filled {
        background: #00ccff;
        box-shadow: 0 0 5px rgba(0, 204, 255, 0.5);
      }

      /* V65: Persistence UI Styles */
      .kanban-setup-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .kanban-setup-btn {
        background: rgba(0, 204, 255, 0.1);
        border: 1px solid rgba(0, 204, 255, 0.2);
        color: #00ccff;
        font-size: 0.7rem;
        padding: 4px 12px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .kanban-setup-btn:hover {
        background: rgba(0, 204, 255, 0.2);
      }

      .kanban-board-select {
        background: #111;
        border: 1px solid #333;
        color: #ccc;
        font-size: 0.7rem;
        padding: 4px;
      }

      .kanban-setup-btn-timid {
        background: transparent;
        border: none;
        color: #555;
        cursor: pointer;
        font-size: 0.7rem;
      }

      .kanban-setup-btn-timid:hover {
        color: #f55;
      }

      /* V66: Vim-Ban Focus Styles */
      .kanban-card.focused {
        border-color: var(--main-color) !important;
        background: rgba(0, 204, 255, 0.1) !important;
        box-shadow: 0 0 10px rgba(0, 204, 255, 0.2);
        position: relative;
        z-index: 2;
      }
      .kanban-card.grabbing {
        border-style: dashed !important;
        opacity: 0.8;
        transform: scale(0.98);
      }
      /* V66: Ghost Navigation */
      .kanban-card.ghost {
        opacity: 0.5;
        background: rgba(255, 255, 255, 0.05) !important;
        border: 2px dashed var(--main-color) !important;
      }
      .kanban-card.original-dimmed {
        opacity: 0.2;
        filter: grayscale(1);
      }

      /* V66.1: COMPACT HUD STYLES (Stealth Mode) */
      .kanban-hud-wrapper {
        background: rgba(10, 10, 12, 0.6);
        border: 1px solid #333;
        border-left: 3px solid var(--main-color);
        border-radius: 4px;
        margin: 10px 0;
        overflow: hidden;
        font-family: var(--font-secondary);
      }

      .hud-header-compact {
        padding: 10px 12px;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.02);
        transition: background 0.2s;
      }
      .hud-header-compact:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .hud-title-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
      }

      .hud-name {
        flex: 1;
        font-weight: bold;
        font-size: 0.8rem;
        color: #eee;
        letter-spacing: 0.5px;
      }

      .hud-percent {
        font-size: 0.7rem;
        color: var(--main-color);
        font-family: monospace;
      }

      .hud-progress-track {
        height: 3px;
        background: #222;
        border-radius: 2px;
        width: 100%;
        overflow: hidden;
      }

      .hud-progress-fill {
        height: 100%;
        background: var(--main-color);
        transition: width 0.3s ease;
      }

      .hud-injector-row {
        border-top: 1px solid #222;
        padding: 0;
      }

      .hud-injector-input {
        width: 100%;
        background: transparent;
        border: none;
        padding: 8px 12px;
        color: #aaa;
        font-family: var(--font-secondary);
        font-size: 0.75rem;
        outline: none;
      }

      .hud-injector-input:focus {
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
      }
      .pipeline-item {
        font-size: 0.8rem;
        padding: 4px;
        border-left: 2px solid #333;
        cursor: pointer;
        margin-bottom: 2px;
        color: #888;
        transition: all 0.2s;
      }
      .pipeline-item:hover {
        border-left-color: var(--main-color);
        color: var(--main-color);
        background: rgba(0, 204, 255, 0.05);
      }
      .pipeline-input {
        width: 100%;
        background: transparent;
        border: none;
        border-bottom: 1px dashed #444;
        color: var(--secondary-color);
        font-size: 0.75rem;
        padding: 4px;
        outline: none;
        font-family: var(--font-primary);
      }
      .pipeline-input:focus {
        border-bottom-color: var(--main-color);
      }

      /* Utilities */
      .kanban-embed-open {
        font-size: 0.6rem;
        color: #444;
        cursor: pointer;
        transition: color 0.2s;
      }

      .kanban-embed-open:hover {
        color: #00ccff;
      }

      .kanban-embed-delete {
        position: absolute;
        top: 8px;
        right: 8px;
        background: transparent;
        border: none;
        color: #333;
        font-size: 0.6rem;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s;
      }

      .block-kanban-ref:hover .kanban-embed-delete {
        opacity: 1;
      }

      /* Preview Mode Embed */
      .kanban-preview-embed {
        font-family: var(--font-primary);
        background: rgba(0, 204, 255, 0.02);
        border: 1px solid rgba(0, 204, 255, 0.1);
        padding: 10px 16px;
        margin: 15px 0;
        cursor: pointer;
      }

      /* SLASH COMMAND MENU */
      .slash-menu {
        position: fixed;
        display: none;
        z-index: calc(var(--z-context-menu) + 1); /* V37: Higher than editor */
        background: #080808;
        border: 1px solid #1a1a1a;
        border-radius: 6px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.9);
        min-width: 260px;
        max-height: 320px;
        overflow-y: auto;
        padding: 6px 0;
        font-family: var(--font-secondary);
        /* V40: Themed scrollbar */
        scrollbar-width: thin;
        scrollbar-color: var(--main-color) transparent;
      }
      .slash-menu::-webkit-scrollbar {
        width: 8px;
      }
      .slash-menu::-webkit-scrollbar-track {
        background: transparent;
      }
      .slash-menu::-webkit-scrollbar-thumb {
        background: var(--main-color);
        border-radius: 4px;
      }

      .slash-menu.active {
        display: block;
        border-color: var(--main-color);
      }

      .slash-item {
        display: flex;
        align-items: center;
        padding: 10px 16px;
        cursor: pointer;
        transition: all 0.1s;
      }

      .slash-item:hover,
      .slash-item.selected {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
      }

      .slash-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 4px;
        margin-right: 14px;
        font-size: 0.9rem;
        color: var(--main-color);
      }

      .slash-label {
        flex: 1;
        color: #ccc;
        font-size: 0.85rem;
      }

      .slash-shortcut {
        color: #444;
        font-size: 0.65rem;
        font-family: monospace;
      }
      /* CALLOUT MODAL */
      .callout-modal-content {
        max-width: 520px !important;
        background: #080808 !important;
        border: 1px solid var(--main-color) !important;
      }
      .callout-modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid #222;
      }
      .callout-modal-body {
        padding: 15px 20px;
        max-height: 60vh;
        overflow-y: auto;
      }
      .callout-form-section {
        margin-bottom: 16px;
      }
      .callout-label {
        display: block;
        color: #666;
        font-size: 0.65rem;
        letter-spacing: 1px;
        margin-bottom: 8px;
        font-family: var(--font-secondary);
      }
      .callout-type-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
      .callout-type-btn {
        background: transparent;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 8px 4px;
        cursor: pointer;
        text-align: center;
        transition: all 0.15s;
        color: #888;
        font-size: 0.75rem;
      }
      .callout-type-btn:hover {
        border-color: #555;
      }
      .callout-type-icon {
        display: block;
        font-size: 1.1rem;
        margin-bottom: 4px;
      }
      .callout-type-label {
        display: block;
        font-size: 0.6rem;
        letter-spacing: 0.5px;
      }
      .callout-input {
        width: 100%;
        background: #111;
        border: 1px solid #333;
        color: #ccc;
        padding: 10px 12px;
        font-size: 0.85rem;
        border-radius: 4px;
        font-family: var(--font-secondary);
        box-sizing: border-box;
      }
      .callout-input:focus {
        outline: none;
        border-color: var(--main-color);
      }
      .callout-textarea {
        width: 100%;
        background: #111;
        border: 1px solid #333;
        color: #ccc;
        padding: 10px 12px;
        font-size: 0.85rem;
        border-radius: 4px;
        font-family: var(--font-secondary);
        resize: vertical;
        min-height: 80px;
        box-sizing: border-box;
      }
      .callout-textarea:focus {
        outline: none;
        border-color: var(--main-color);
      }
      .callout-preview-section {
        margin-top: 12px;
      }
      .callout-modal-footer {
        padding: 12px 20px;
        border-top: 1px solid #222;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      /* KANBAN MODAL */
      #kanban-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 94vw;
        height: 85vh;
        background: rgba(5, 5, 8, 0.98);
        border: 1px solid var(--main-color);
        z-index: calc(var(--z-context-menu) + 5) !important;
        display: none;
        flex-direction: column;
        box-shadow: 0 0 100px rgba(0, 0, 0, 1);
        backdrop-filter: blur(20px);
      }

      .kanban-modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-family: var(--font-secondary);
        font-size: 0.7rem;
        letter-spacing: 1px;
        color: var(--main-color);
      }

      .kanban-modal-close {
        background: none;
        border: none;
        color: #555;
        cursor: pointer;
        font-size: 1rem;
        padding: 5px 10px;
      }

      .kanban-modal-close:hover {
        color: var(--main-color);
      }

      #kanban-container {
        flex: 1;
        padding: 20px;
        display: flex;
        gap: 20px;
        overflow-x: auto;
        /* V41: Themed scrollbar */
        scrollbar-width: thin;
        scrollbar-color: var(--main-color) transparent;
      }
      #kanban-container::-webkit-scrollbar {
        height: 8px;
      }
      #kanban-container::-webkit-scrollbar-track {
        background: transparent;
      }
      #kanban-container::-webkit-scrollbar-thumb {
        background: var(--main-color);
        border-radius: 4px;
      }

      .kanban-column {
        width: 320px;
        min-width: 320px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        flex-direction: column;
        height: 100%;
        transition: all 0.2s;
      }

      .kanban-column.selected-col {
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.03);
        border-color: rgba(var(--main-color-rgb, 0, 255, 65), 0.2);
      }

      .kanban-column-header {
        padding: 12px 15px;
        font-size: 0.65rem;
        color: var(--main-color);
        background: rgba(255, 255, 255, 0.03);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        font-weight: bold;
      }

      .kanban-card-list {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      /* V65: Enhanced Kanban Card with Delete */
      .kanban-card {
        position: relative;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 12px 30px 12px 15px;
        font-size: 0.85rem;
        color: #ccc;
        cursor: grab;
        transition: all 0.2s;
      }

      .kanban-card:hover,
      .kanban-card.selected {
        border-color: var(--main-color);
        background: rgba(var(--main-color-rgb, 0, 255, 65), 0.05);
        box-shadow: 0 0 10px rgba(var(--main-color-rgb, 0, 255, 65), 0.1);
      }

      .kanban-card.dragging {
        opacity: 0.5;
      }

      .kanban-card-content {
        cursor: text;
        line-height: 1.4;
      }

      .kanban-card-delete {
        position: absolute;
        top: 8px;
        right: 8px;
        background: transparent;
        border: none;
        color: #555;
        font-size: 1rem;
        cursor: pointer;
        opacity: 0;
        transition: all 0.15s;
        padding: 2px 6px;
      }

      .kanban-card:hover .kanban-card-delete {
        opacity: 1;
      }

      .kanban-card-delete:hover {
        color: #f55;
      }

      /* V65: Card Edit Textarea */
      .kanban-card-edit {
        width: 100%;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--main-color);
        color: #ccc;
        font-family: var(--font-secondary);
        font-size: 0.85rem;
        padding: 8px;
        resize: none;
        outline: none;
      }

      /* V65: Inline Input Area */
      .kanban-input-area {
        margin: 10px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .kanban-card-input {
        width: 100%;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #ccc;
        font-family: var(--font-secondary);
        font-size: 0.85rem;
        padding: 10px;
        resize: none;
        outline: none;
        margin-bottom: 8px;
      }

      .kanban-card-input:focus {
        border-color: var(--main-color);
      }

      .kanban-input-actions {
        display: flex;
        gap: 8px;
      }

      .kanban-input-save {
        flex: 1;
        padding: 8px;
        background: var(--main-color);
        border: none;
        color: #000;
        font-family: var(--font-primary);
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.15s;
      }

      .kanban-input-save:hover {
        filter: brightness(1.2);
      }

      .kanban-input-cancel {
        padding: 8px 12px;
        background: transparent;
        border: 1px solid #555;
        color: #888;
        font-family: var(--font-primary);
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.15s;
      }

      .kanban-input-cancel:hover {
        border-color: #f55;
        color: #f55;
      }

      /* V65: Column Header with Actions */
      .kanban-column-header {
        padding: 12px 15px;
        font-size: 0.65rem;
        color: var(--main-color);
        background: rgba(255, 255, 255, 0.03);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .kanban-col-title {
        flex: 1;
        cursor: pointer;
      }

      .kanban-col-title:hover {
        text-decoration: underline;
      }

      .kanban-col-title-edit {
        flex: 1;
        background: transparent;
        border: none;
        border-bottom: 1px solid var(--main-color);
        color: var(--main-color);
        font-family: var(--font-primary);
        font-size: 0.65rem;
        font-weight: bold;
        outline: none;
        padding: 0;
      }

      .kanban-col-delete {
        background: transparent;
        border: none;
        color: #555;
        font-size: 0.9rem;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.15s;
        padding: 0 4px;
      }

      .kanban-column:hover .kanban-col-delete {
        opacity: 1;
      }

      .kanban-col-delete:hover {
        color: #f55;
      }

      /* V65: Add Column Button */
      .kanban-add-column {
        min-width: 200px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.02);
        border: 1px dashed rgba(255, 255, 255, 0.1);
        color: #555;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.7rem;
        font-family: var(--font-primary);
      }

      .kanban-add-column:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--main-color);
        color: var(--main-color);
      }

      /* V65: Kanban Tags */
      .kanban-tag {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.7rem;
        margin-right: 4px;
        background: rgba(255, 255, 255, 0.1);
        color: #888;
      }

      .kanban-tag.urgent {
        background: rgba(255, 85, 85, 0.2);
        color: #f55;
      }

      .kanban-tag.dev {
        background: rgba(85, 170, 255, 0.2);
        color: #5af;
      }

      .kanban-tag.design {
        background: rgba(170, 85, 255, 0.2);
        color: #a5f;
      }

      .kanban-add-card {
        margin: 10px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px dashed rgba(255, 255, 255, 0.1);
        color: #666;
        cursor: pointer;
        font-size: 0.7rem;
        transition: all 0.2s;
      }

      .kanban-add-card:hover {
        border-color: var(--main-color);
        color: var(--main-color);
        background: rgba(255, 255, 255, 0.08);
      }

      .kanban-column.drag-over {
        background: rgba(0, 255, 65, 0.02);
        border-color: var(--main-color);
      }

      .kanban-placeholder {
        height: 40px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px dashed var(--main-color);
        margin-bottom: 10px;
      }

      .col-count {
        color: #555;
        font-size: 0.6rem;
      }

      #kanban-modal.active {
        display: flex;
      }

      .kanban-modal-header {
        padding: 15px 25px;
        border-bottom: 1px solid #1a1a1a;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .kanban-modal-title {
        color: var(--main-color);
        font-size: 1rem;
        letter-spacing: 2px;
        font-family: var(--font-main);
      }

      #kanban-container {
        flex: 1;
        display: flex;
        gap: 20px;
        padding: 25px;
        overflow-x: auto;
        background: rgba(0, 0, 0, 0.4);
      }

      /* RE-USING KANBAN STYLES ALREADY ADDED IN PHASE 3.1 */

      .kanban-modal-close {
        background: transparent;
        border: 1px solid var(--danger-color);
        color: var(--danger-color);
        padding: 4px 10px;
        cursor: pointer;
        font-family: var(--font-secondary);
        font-size: 0.7rem;
      }

      .kanban-modal-close:hover {
        background: var(--danger-color);
        color: #000;
      }

      /* V67: Notion-Style Kanban HUD (Deep Content System) */
      .hud-tag {
        color: var(--main-color);
        background: rgba(0, 255, 65, 0.1);
        padding: 0 4px;
        border-radius: 2px;
        font-size: 0.7em;
        margin-right: 4px;
        border: 1px solid rgba(0, 255, 65, 0.2);
      }
      .hud-item {
        padding: 8px 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer; /* Change to pointer to indicate clickability */
        transition: background 0.2s;
        position: relative;
      }
      .hud-item:last-child {
        border-bottom: none;
      }
      .hud-item:hover {
        background: rgba(255, 255, 255, 0.03);
      }
      .hud-item-text {
        font-size: 0.8rem;
        color: #ccc;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 85%;
      }
      .hud-advance-btn {
        opacity: 0;
        cursor: pointer;
        font-weight: bold;
        color: var(--main-color);
        padding: 0 6px;
        border-radius: 2px;
      }
      .hud-item:hover .hud-advance-btn {
        opacity: 1;
      }
      .hud-advance-btn:hover {
        background: rgba(0, 255, 65, 0.1);
      }

      /* V76: Knowledge Graph Styles */
      .graph-node {
        cursor: pointer;
        stroke: #fff;
        stroke-width: 0px;
        transition: all 0.2s;
      }

      .graph-node.active {
        stroke-width: 2px;
        stroke: var(--main-color);
      }

      .graph-node:hover {
        stroke-width: 2px;
        stroke: #fff;
      }

      .graph-link {
        transition: all 0.2s;
      }

      .graph-label {
        pointer-events: none;
        text-shadow: 0 1px 2px #000;
        transition: all 0.2s;
      }

      /* Focus Mode Classes */
      .highlighted {
        opacity: 1 !important;
        stroke-opacity: 1 !important;
      }

      circle.highlighted {
        fill: #fff !important;
      }

      .dimmed {
        opacity: 0.1 !important;
        stroke-opacity: 0.1 !important;
      }
    </style>
  </head>

  <body>
    <!-- CRT SCANLINE OVERLAY -->
    <div class="crt-overlay" id="crt-overlay"></div>
    <!-- VIGNETTE OVERLAY (V17) -->
    <div class="vignette-overlay" id="vignette-overlay"></div>
    <!-- NOISE OVERLAY (V17) -->
    <div class="noise-overlay" id="noise-overlay"></div>
    <!-- KANBAN MODAL (PHASE 5) -->
    <div id="kanban-modal">
      <div class="kanban-modal-header">
        <span class="kanban-modal-title" id="kanban-modal-title"
          >DATA_BOARD // BUFFERING</span
        >
        <button class="kanban-modal-close" id="kanban-modal-close-btn">
          X
        </button>
      </div>
      <div id="kanban-container"></div>
    </div>

    <!-- MODAL OVERLAY (V18.7) -->
    <div class="modal-overlay" id="modal-overlay"></div>

    <!-- BACKGROUND VIDEO -->
    <video autoplay muted loop playsinline id="bg-video"></video>

    <!-- CONFIG BUTTON -->
    <svg id="config-btn" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
      />
    </svg>

    <!-- HELP BUTTON -->
    <div id="help-btn">?</div>

    <!-- WEATHER WIDGET -->
    <div id="weather-widget">
      <div class="weather-main">
        <span class="weather-temp" id="weather-temp">--</span>
        <span class="weather-unit" id="weather-unit"></span>
      </div>
      <div class="weather-condition" id="weather-condition">LOADING...</div>
      <div class="weather-location" id="weather-location"></div>
      <div class="weather-extra" id="weather-extra">
        <div class="weather-extra-row">
          <span class="label">HUMIDITY</span>
          <span class="value" id="weather-humidity">--%</span>
        </div>
        <div class="weather-extra-row">
          <span class="label">WIND</span>
          <span class="value" id="weather-wind">-- km/h</span>
        </div>
        <div class="weather-extra-row">
          <span class="label">FEELS LIKE</span>
          <span class="value" id="weather-feels">--</span>
        </div>
      </div>
      <div class="weather-toggle" id="weather-toggle">[ MORE INFO ]</div>
    </div>

    <!-- STATUS BAR -->
    <div id="status-bar">
      <div class="status-item">
        <span class="label">UPTIME:</span>
        <span class="value" id="uptime">00:00:00</span>
      </div>
      <div class="status-item">
        <span class="label">SESSIONS:</span>
        <span class="value" id="session-count">0</span>
      </div>
      <div class="status-item streak-container">
        <span class="label">STREAK:</span>
        <span class="value" id="streak-count">0</span>
        <span class="label">DAYS</span>
      </div>
    </div>

    <!-- CONFIG MODAL -->
    <div id="config-modal" class="modal">
      <div class="config-header">
        <span>SYSTEM_CONFIG //</span>
        <div style="display: flex; align-items: center; gap: 10px">
          <button id="header-update-btn" style="display: none">
            [~] UPDATE THEME
          </button>
          <button id="header-save-btn">SAVE</button>
          <span style="color: #333; font-size: 1.2rem">|</span>
          <span class="close-modal" id="config-close-x">X</span>
        </div>
      </div>

      <div class="config-body">
        <!-- SIDEBAR -->
        <div class="config-sidebar">
          <div class="config-search">
            <input
              type="text"
              id="config-search-input"
              placeholder="Search settings..."
            />
          </div>
          <!-- V19.32: Removed Quick Access, Interface is now first/default -->
          <div class="config-nav">
            <div class="config-nav-item active" data-tab="interface">
              INTERFACE
            </div>
            <div class="config-nav-item" data-tab="notes">NOTES</div>
            <div class="config-nav-item" data-tab="system">SYSTEM</div>
            <div class="config-nav-item" data-tab="modules">MODULES</div>
            <div class="config-nav-item" data-tab="maintenance">
              MAINTENANCE
            </div>
          </div>
        </div>

        <!-- CONTENT AREA -->
        <div class="config-content">
          <!-- V19.32: INTERFACE TAB (Merged with Quick Access) -->
          <div class="config-tab active" id="tab-interface">
            <!-- THEME SECTION -->
            <div class="config-tab-title">> THEME</div>
            <div class="config-row" style="margin-bottom: 15px">
              <span class="config-label">THEME PRESET</span>
              <select id="cfg-theme-preset" class="config-input">
                <option value="">-- Select Theme --</option>
              </select>
            </div>
            <div class="config-group">
              <span class="config-label">PRIMARY COLOR</span>
              <input
                type="text"
                class="config-input"
                id="cfg-color"
                placeholder="#00FF41"
                autocomplete="off"
              />
            </div>
            <div class="config-row">
              <span class="config-label">SECONDARY COLOR</span>
              <input
                type="color"
                id="cfg-secondary-color"
                class="config-input"
                value="#888888"
              />
            </div>
            <div
              class="config-row"
              style="margin-top: 10px; display: flex; gap: 10px"
            >
              <button
                type="button"
                class="theme-action-btn"
                id="btn-save-theme"
              >
                [+] SAVE THEME
              </button>
              <button
                type="button"
                class="theme-action-btn"
                id="btn-export-theme"
              >
                [^] EXPORT
              </button>
              <button
                type="button"
                class="theme-action-btn"
                id="btn-import-theme"
              >
                [v] IMPORT
              </button>
            </div>
            <button
              type="button"
              class="theme-action-btn"
              id="btn-delete-theme"
              style="
                display: none;
                margin-top: 10px;
                width: 100%;
                border-color: var(--danger-color);
                color: var(--danger-color);
              "
            >
              [X] DELETE SELECTED
            </button>

            <!-- APPEARANCE SECTION -->
            <div class="config-tab-title" style="margin-top: 25px">
              > APPEARANCE
            </div>
            <div class="toggle-row">
              <span class="toggle-label">HIDE COMPLETED TASKS</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-hide-completed" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">BLUR OVERLAY</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-blur-overlay" checked /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">CRT SCANLINES</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-crt" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">VIGNETTE</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-vignette" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">NOISE / GRAIN</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-noise" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">TYPING SOUNDS</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-sounds" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">UI SOUNDS</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-ui-sounds" /><span
                  class="slider"
                ></span
              ></label>
            </div>

            <!-- TYPOGRAPHY SECTION -->
            <div class="config-tab-title" style="margin-top: 25px">
              > TYPOGRAPHY
            </div>
            <div class="config-row">
              <span class="config-label">CLOCK FONT</span>
              <select id="cfg-font" class="config-input">
                <option value="Space Mono">Space Mono</option>
                <option value="JetBrains Mono">JetBrains Mono</option>
                <option value="Fira Code">Fira Code</option>
                <option value="IBM Plex Mono">IBM Plex Mono</option>
                <option value="Source Code Pro">Source Code Pro</option>
                <option value="Inconsolata">Inconsolata</option>
                <option value="Roboto Mono">Roboto Mono</option>
                <option value="Ubuntu Mono">Ubuntu Mono</option>
                <option value="VT323">VT323 (Retro)</option>
              </select>
            </div>
            <div class="slider-row">
              <span class="slider-label">CLOCK SIZE</span>
              <input
                type="range"
                id="cfg-clock-size"
                min="3"
                max="10"
                value="7"
              />
              <span class="slider-value" id="cfg-clock-size-val">7rem</span>
            </div>
            <div class="config-row">
              <span class="config-label">SECONDARY FONT</span>
              <select id="cfg-font-secondary" class="config-input">
                <option value="'Space Mono', monospace">Space Mono</option>
                <option value="'JetBrains Mono', monospace">
                  JetBrains Mono
                </option>
                <option value="'Fira Code', monospace">Fira Code</option>
                <option value="'IBM Plex Mono', monospace">
                  IBM Plex Mono
                </option>
                <option value="'Source Code Pro', monospace">
                  Source Code Pro
                </option>
                <option value="'Inconsolata', monospace">Inconsolata</option>
                <option value="'Roboto Mono', monospace">Roboto Mono</option>
                <option value="'Ubuntu Mono', monospace">Ubuntu Mono</option>
                <option value="'VT323', monospace">VT323</option>
                <option value="Courier New">Courier New</option>
                <option value="Arial, sans-serif">Arial (Sans)</option>
              </select>
            </div>

            <!-- VIDEO FILTERS SECTION -->
            <div class="config-tab-title" style="margin-top: 25px">
              > VIDEO FILTERS
            </div>
            <div class="toggle-row">
              <span class="toggle-label">ENABLE VIDEO FILTER</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-filter-enabled" checked /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="slider-row">
              <span class="slider-label">GRAYSCALE</span>
              <input
                type="range"
                id="cfg-grayscale"
                min="0"
                max="100"
                value="100"
              />
              <span class="slider-value" id="cfg-grayscale-val">100%</span>
            </div>
            <div class="slider-row">
              <span class="slider-label">CONTRAST</span>
              <input
                type="range"
                id="cfg-contrast"
                min="50"
                max="200"
                value="120"
              />
              <span class="slider-value" id="cfg-contrast-val">120%</span>
            </div>
            <div class="slider-row">
              <span class="slider-label">BRIGHTNESS</span>
              <input
                type="range"
                id="cfg-brightness"
                min="20"
                max="150"
                value="60"
              />
              <span class="slider-value" id="cfg-brightness-val">60%</span>
            </div>
            <div class="slider-row">
              <span class="slider-label">BLUR</span>
              <input type="range" id="cfg-blur" min="0" max="10" value="0" />
              <span class="slider-value" id="cfg-blur-val">0px</span>
            </div>

            <!-- BACKGROUNDS SECTION -->
            <div class="config-row">
              <span class="config-label">BACKGROUND TYPE</span>
              <select id="cfg-bg-type" class="config-input">
                <option value="media" selected>Dynamic Media</option>
                <option value="color">Solid Color</option>
              </select>
            </div>
            <div class="config-group">
              <span class="config-label">BACKGROUND COLOR</span>
              <input
                type="text"
                class="config-input"
                id="cfg-bg-color"
                placeholder="#000000"
                autocomplete="off"
              />
            </div>
            <div
              class="config-group"
              style="flex-direction: column; align-items: stretch"
            >
              <span class="config-label" style="margin-bottom: 10px"
                >MEDIA URLs (One per line)</span
              >
              <textarea
                id="cfg-backgrounds"
                class="config-input"
                style="
                  width: 100%;
                  display: block;
                  height: 80px;
                  max-height: 400px;
                  resize: vertical;
                "
              ></textarea>

              <div style="text-align: right">
                <div
                  style="
                    font-size: 0.7rem;
                    color: #555;
                    margin-top: 5px;
                    margin-bottom: 15px;
                    font-family: var(--font-secondary);
                  "
                >
                  // DRAG CORNER TO RESIZE
                </div>
                <div
                  style="
                    display: flex;
                    gap: 10px;
                    align-items: center;
                    justify-content: flex-end;
                  "
                >
                  <span
                    id="upload-status"
                    style="font-size: 0.75rem; color: #888"
                  ></span>
                  <button
                    type="button"
                    id="upload-bg-btn"
                    class="action-btn"
                    style="
                      background: #222;
                      border: 1px solid var(--main-color);
                      color: var(--main-color);
                      padding: 8px 15px;
                    "
                  >
                    + UPLOAD
                  </button>
                  <input
                    type="file"
                    id="bg-file-input"
                    accept="video/*,image/*"
                    multiple
                    style="display: none"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- SYSTEM TAB -->
          <div class="config-tab" id="tab-system">
            <div class="config-tab-title">> SYSTEM</div>
            <div class="config-group">
              <span class="config-label">OPERATOR NAME</span>
              <input
                type="text"
                class="config-input"
                id="cfg-name"
                placeholder="OPERATOR"
                autocomplete="name"
              />
            </div>
            <div class="config-row">
              <span class="config-label">SEARCH ENGINE</span>
              <select id="cfg-engine" class="config-input">
                <option value="google">Google</option>
                <option value="ddg">DuckDuckGo</option>
                <option value="bing">Bing</option>
                <option value="brave">Brave Search</option>
                <option value="perplexity">Perplexity AI</option>
                <option value="chatgpt">ChatGPT</option>
                <option value="youtube">YouTube</option>
              </select>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">SHOW BOOKMARKS BAR</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-show-bm" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">SHOW SECONDS</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-show-seconds" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="config-tab-title" style="margin-top: 25px">
              > WEATHER
            </div>
            <div class="config-group">
              <span class="config-label">LOCATION (City)</span>
              <input
                type="text"
                class="config-input"
                id="cfg-location"
                placeholder="New York"
                autocomplete="off"
              />
            </div>
            <div class="toggle-row">
              <span class="toggle-label">USE CELSIUS</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-celsius" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">SHOW EXTENDED INFO</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-weather-extended" /><span
                  class="slider"
                ></span
              ></label>
            </div>
            <div class="slider-row">
              <span class="slider-label">WEATHER SCALE</span>
              <input
                type="range"
                id="cfg-weather-scale"
                min="0.5"
                max="1.5"
                step="0.1"
                value="1"
              />
              <span class="slider-value" id="cfg-weather-scale-val">1x</span>
            </div>
          </div>

          <!-- MODULES TAB -->
          <div class="config-tab" id="tab-modules">
            <div class="config-tab-title">> TASKS</div>
            <div class="config-row">
              <span class="config-label">AUTO-CLEAR TASKS</span>
              <select id="cfg-auto-clear-interval" class="config-input">
                <option value="never">NEVER</option>
                <option value="daily">DAILY</option>
                <option value="2days">EVERY 2 DAYS</option>
                <option value="weekly">WEEKLY</option>
                <option value="biweekly">BIWEEKLY</option>
                <option value="monthly">MONTHLY</option>
              </select>
            </div>

            <div class="config-tab-title" style="margin-top: 25px">
              > DOCK LINKS
            </div>
            <div class="add-row">
              <input
                type="text"
                id="new-dock-name"
                class="config-input"
                placeholder="Label"
                style="flex: 1"
                autocomplete="off"
              />
              <input
                type="text"
                id="new-dock-url"
                class="config-input"
                placeholder="https://..."
                style="flex: 2"
                autocomplete="off"
              />
              <button id="add-dock-btn">+</button>
            </div>
            <div id="dock-list"></div>

            <div class="config-tab-title" style="margin-top: 25px">
              > CUSTOM COMMANDS
            </div>
            <div class="add-row">
              <input
                type="text"
                id="new-cmd-trigger"
                class="config-input"
                placeholder="Trigger"
                style="flex: 1"
                autocomplete="off"
              />
              <input
                type="text"
                id="new-cmd-url"
                class="config-input"
                placeholder="https://..."
                style="flex: 2"
                autocomplete="off"
              />
              <button id="add-cmd-btn">+</button>
            </div>
            <div id="custom-cmd-list"></div>

            <div class="config-tab-title" style="margin-top: 25px">
              > INTEGRATIONS
            </div>
            <div class="config-group">
              <span class="config-label">HABIT TRACKER SHEET ID</span>
              <input
                type="text"
                class="config-input"
                id="cfg-habit"
                autocomplete="off"
                placeholder="Sheet ID"
              />
            </div>
            <div class="config-group">
              <span class="config-label">GEMINI LIFE ID</span>
              <input
                type="text"
                class="config-input"
                id="cfg-life"
                autocomplete="off"
              />
            </div>
            <div class="config-group">
              <span class="config-label">TRELLO BOARD ID</span>
              <input
                type="text"
                class="config-input"
                id="cfg-trello"
                autocomplete="off"
              />
            </div>
            <div class="config-group">
              <span class="config-label">NOTION PAGE ID</span>
              <input
                type="text"
                class="config-input"
                id="cfg-notion"
                autocomplete="off"
              />
            </div>
            <div class="config-group">
              <span class="config-label">GITHUB USERNAME</span>
              <input
                type="text"
                class="config-input"
                id="cfg-github"
                autocomplete="off"
              />
            </div>
          </div>

          <!-- V63.4: Notes Tab -->
          <div class="config-tab" id="tab-notes">
            <div class="config-tab-title">> NOTE EDITOR</div>
            <div class="toggle-row">
              <span class="toggle-label">ENABLE TABS</span>
              <label class="switch"
                ><input type="checkbox" id="cfg-notes-tabs-enabled" /><span
                  class="slider"
                ></span
              ></label>
            </div>
          </div>
          <div class="config-tab" id="tab-maintenance">
            <div class="config-tab-title">> DATA MANAGEMENT</div>
            <div
              style="
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                margin-bottom: 20px;
              "
            >
              <button class="action-btn" id="export-config">
                EXPORT CONFIG
              </button>
              <button class="action-btn" id="import-btn">IMPORT CONFIG</button>
              <input
                type="file"
                id="import-file"
                style="display: none"
                accept=".json"
              />
            </div>

            <div class="config-tab-title" style="margin-top: 25px">
              > DANGER ZONE
            </div>
            <div
              style="
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                margin-bottom: 20px;
              "
            >
              <button
                class="action-btn"
                id="reset-config"
                style="
                  border-color: var(--danger-color);
                  color: var(--danger-color);
                "
              >
                FACTORY RESET
              </button>
              <button
                class="action-btn"
                id="clear-data"
                style="
                  border-color: var(--danger-color);
                  color: var(--danger-color);
                "
              >
                CLEAR ALL DATA
              </button>
            </div>

            <div class="config-tab-title" style="margin-top: 25px">
              > RAW CONFIG (JSON)
            </div>
            <p style="color: #666; font-size: 0.75rem; margin-bottom: 15px">
              Edit raw configuration. Changes apply on Save.
            </p>
            <textarea
              id="cfg-json-dump"
              class="config-input"
              style="
                width: 100%;
                display: block;
                height: 200px;
                max-height: 400px;
                font-family: monospace;
                font-size: 0.75rem;
                resize: vertical;
              "
            ></textarea>
            <div
              style="
                text-align: right;
                font-size: 0.7rem;
                color: #555;
                margin-top: 5px;
                margin-bottom: 15px;
                font-family: var(--font-secondary);
              "
            >
              // DRAG CORNER TO RESIZE
            </div>
            <button
              type="button"
              id="copy-config-json"
              class="action-btn"
              style="
                margin-top: 15px;
                margin-bottom: 30px;
                display: block;
                width: 100%;
              "
            >
              [COPY TO CLIPBOARD]
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- HELP MODAL -->
    <div id="help-modal" class="modal">
      <div class="config-header">
        OPERATOR MANUAL //
        <span class="close-modal" id="help-modal-close">X</span>
      </div>
      <div class="modal-body" style="padding: 20px; flex: 1; overflow-y: auto">
        <table class="help-table">
          <tr>
            <td class="help-cmd">help / man</td>
            <td>Open this manual</td>
          </tr>
          <tr>
            <td class="help-cmd">task [text]</td>
            <td>Create a new task</td>
          </tr>
          <tr>
            <td class="help-cmd">task !! / ! / ~ [text]</td>
            <td>Priority: High / Medium / Low</td>
          </tr>
          <tr>
            <td class="help-cmd">task @cat [text]</td>
            <td>Task with category</td>
          </tr>
          <tr>
            <td class="help-cmd">task [text] at [time]</td>
            <td>Task with deadline</td>
          </tr>
          <tr>
            <td class="help-cmd">done [#]</td>
            <td>Mark task # as complete</td>
          </tr>
          <tr>
            <td class="help-cmd">hide done</td>
            <td>Hide completed tasks (V18.4)</td>
          </tr>
          <tr>
            <td class="help-cmd">show done</td>
            <td>Show completed tasks (V18.4)</td>
          </tr>
          <tr>
            <td class="help-cmd">note [text]</td>
            <td>Save a quick note</td>
          </tr>
          <tr>
            <td class="help-cmd">notes</td>
            <td>Toggle notes panel</td>
          </tr>
          <tr>
            <td class="help-cmd">focus [time]</td>
            <td>Start timer (e.g. 25, 1:30, 90s)</td>
          </tr>
          <tr>
            <td class="help-cmd">history</td>
            <td>View command history</td>
          </tr>
          <tr>
            <td class="help-cmd">clear</td>
            <td>Clear all tasks</td>
          </tr>
          <tr>
            <td class="help-cmd">clear task [#]</td>
            <td>Clear task by number (V18.3)</td>
          </tr>
          <tr>
            <td class="help-cmd">clear task [name]</td>
            <td>Clear task(s) by name (V18.3)</td>
          </tr>
          <tr>
            <td class="help-cmd">clear notes</td>
            <td>Clear all notes</td>
          </tr>
          <tr>
            <td class="help-cmd">mail [subject]</td>
            <td>Compose Gmail</td>
          </tr>
          <tr>
            <td class="help-cmd">sheet [name]</td>
            <td>Open Google Sheet</td>
          </tr>
          <tr>
            <td class="help-cmd">weather set [location]</td>
            <td>Set weather location (V63.4)</td>
          </tr>
          <tr>
            <td class="help-cmd">b [query]</td>
            <td>Search bookmarks</td>
          </tr>
          <tr>
            <td class="help-cmd">yt [query]</td>
            <td>Search YouTube</td>
          </tr>
          <tr>
            <td class="help-cmd">trello</td>
            <td>Open Trello Board</td>
          </tr>
          <tr>
            <td class="help-cmd">notion</td>
            <td>Open Notion Page</td>
          </tr>
          <tr>
            <td class="help-cmd">github [user]</td>
            <td>Open GitHub Profile</td>
          </tr>
          <tr>
            <td class="help-cmd">gcal / calendar</td>
            <td>Open Google Calendar</td>
          </tr>
          <tr>
            <td class="help-cmd">gtasks / tasks</td>
            <td>Open Google Tasks</td>
          </tr>
          <tr>
            <td class="help-cmd">gmail / email</td>
            <td>Open Gmail</td>
          </tr>
          <tr>
            <td class="help-cmd">gdocs / drive</td>
            <td>Open Google Docs / Drive</td>
          </tr>
          <tr>
            <td class="help-cmd">roll / coin / quote</td>
            <td>Dice, Coin, or Random Quote</td>
          </tr>
          <tr>
            <td class="help-cmd">calc [expr]</td>
            <td>Quick calculator</td>
          </tr>
        </table>
        <div
          style="
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #333;
          "
        >
          <div style="color: #666; font-size: 0.75rem; margin-bottom: 10px">
            KEYBOARD SHORTCUTS
          </div>
          <table class="help-table">
            <tr>
              <td class="help-cmd">Esc</td>
              <td>Close modal / Clear input</td>
            </tr>
            <tr>
              <td class="help-cmd">Ctrl+K or /</td>
              <td>Focus command input</td>
            </tr>
            <tr>
              <td class="help-cmd">Up / Down</td>
              <td>History or Suggestions</td>
            </tr>
            <tr>
              <td class="help-cmd">Cmd + E</td>
              <td>Toggle Knowledge Graph</td>
            </tr>
            <tr>
              <td class="help-cmd">Cmd + \</td>
              <td>Toggle Sidebar</td>
            </tr>
            <tr>
              <td class="help-cmd">Cmd + B/I/U/K</td>
              <td>Text Styling (Bold, Link, etc)</td>
            </tr>
            <tr>
              <td class="help-cmd">Shift + Enter</td>
              <td>New Block (Editor)</td>
            </tr>
          </table>
        </div>
        <div
          style="
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #333;
          "
        >
          <div style="color: #666; font-size: 0.75rem; margin-bottom: 10px">
            TIPS
          </div>
          <ul
            style="
              color: #888;
              font-size: 0.8rem;
              padding-left: 20px;
              line-height: 1.6;
            "
          >
            <li>
              Click the
              <span style="color: var(--main-color)">gear icon</span> to
              customize settings
            </li>
            <li>Click task checkboxes to mark complete</li>
            <li>Click notes to edit them (V18.4)</li>
            <li>
              Use <span style="color: var(--main-color)">hide done</span> /
              <span style="color: var(--main-color)">show done</span> to toggle
              completed tasks
            </li>
            <li>Type any text and press Enter to search</li>
            <li>Set your location in settings for weather</li>
          </ul>
        </div>

        <div
          style="
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #333;
            text-align: center;
            opacity: 0.6;
          "
        >
          <div style="font-size: 0.65rem; color: #666">
            <span id="app-version-display"
              >OPERATOR NEW TAB v... // 100% LOCAL EXECUTION</span
            ><br />
            NO DATA SENT TO SERVERS (EXCEPT WEATHER/MEDIA)<br />
            OPEN SOURCE SOFTWARE // MIT LICENSE
          </div>
        </div>
      </div>
    </div>

    <!-- HISTORY MODAL -->
    <div id="history-modal" class="modal" style="width: 400px">
      <div class="config-header">
        COMMAND_HISTORY //
        <span class="close-modal">X</span>
      </div>
      <div style="padding: 15px" id="history-list"></div>
    </div>

    <!-- WELCOME MODAL -->
    <div id="welcome-modal" class="modal">
      <div class="config-header">
        WELCOME, OPERATOR //
        <span class="close-modal">X</span>
      </div>
      <div class="welcome-content">
        <div class="welcome-title">// SYSTEM INITIALIZED //</div>

        <div class="welcome-section">
          <div class="welcome-section-title">Quick Commands</div>
          <ul class="welcome-list">
            <li><code>task Buy groceries</code> - Create a task</li>
            <li><code>focus 25</code> - Start 25 min timer</li>
            <li><code>note Remember this</code> - Quick note</li>
            <li><code>help</code> - Full command list</li>
          </ul>
        </div>

        <div class="welcome-section">
          <div class="welcome-section-title">Getting Started</div>
          <ul class="welcome-list">
            <li>
              Click the <strong>gear icon</strong> (top-left) to customize
            </li>
            <li>
              Set your <strong>name</strong> and <strong>location</strong> for
              weather
            </li>
            <li>Add your favorite <strong>dock links</strong></li>
            <li>Type anything and press <strong>Enter</strong> to search</li>
          </ul>
        </div>

        <button class="welcome-start-btn" id="welcome-dismiss">
          BEGIN SESSION
        </button>
      </div>
    </div>

    <!-- POMODORO COMPLETE MODAL -->
    <div id="pomodoro-complete-modal" class="modal">
      <div class="config-header">
        SESSION COMPLETE //
        <span class="close-modal">X</span>
      </div>
      <div class="pomodoro-complete-content">
        <div class="pomodoro-complete-icon">&#x2713;</div>
        <div class="pomodoro-complete-title">FOCUS SESSION COMPLETE</div>
        <div class="pomodoro-complete-subtitle">
          Excellent work, Operator. Time for a break.
        </div>
        <div class="pomodoro-complete-stats">
          <div class="pomodoro-stat-row">
            <span class="pomodoro-stat-label">DURATION</span>
            <span class="pomodoro-stat-value" id="pomo-complete-duration"
              >25:00</span
            >
          </div>
          <div class="pomodoro-stat-row">
            <span class="pomodoro-stat-label">COMPLETED AT</span>
            <span class="pomodoro-stat-value" id="pomo-complete-time"
              >--:--</span
            >
          </div>
        </div>
        <button class="pomodoro-dismiss-btn" id="pomo-dismiss-btn">
          ACKNOWLEDGE
        </button>
      </div>
    </div>

    <!-- CONFIRMATION MODAL -->
    <div id="confirm-modal" class="modal">
      <div class="config-header">
        SYSTEM_CONFIRM //
        <span class="close-modal">X</span>
      </div>
      <div
        class="modal-content"
        style="max-width: 400px; text-align: center; margin: 20px auto"
      >
        <h2
          id="confirm-title"
          style="color: var(--main-color); margin-bottom: 10px"
        >
          TITLE
        </h2>
        <p id="confirm-msg" style="margin: 15px 0; color: #888">
          Message goes here...
        </p>
        <div
          class="modal-actions"
          style="justify-content: center; gap: 10px; margin-top: 20px"
        >
          <button id="confirm-btn-cancel" class="btn">CANCEL</button>
          <button id="confirm-btn-ok" class="btn primary-btn">CONFIRM</button>
        </div>
      </div>
    </div>

    <!-- V87: GENERIC INPUT MODAL (used by ModalManager.openInput) -->
    <div id="input-modal" class="modal">
      <div class="config-header">
        <span id="input-modal-title">INPUT //</span>
        <span class="close-modal" id="input-modal-close">X</span>
      </div>
      <div style="padding: 20px; text-align: center">
        <input
          type="text"
          id="input-modal-field"
          class="config-input"
          placeholder="..."
          autocomplete="off"
          style="width: 100%; margin-bottom: 15px; text-align: center"
        />
        <div class="modal-actions" style="justify-content: center; gap: 10px">
          <button id="input-modal-cancel" class="btn">CANCEL</button>
          <button id="input-modal-confirm" class="btn primary-btn">
            CONFIRM
          </button>
        </div>
      </div>
    </div>

    <!-- THEME MODAL (V17) -->
    <div id="theme-modal" class="modal">
      <div class="config-header">
        <span id="theme-modal-title">THEME_EXPORT //</span>
        <span class="close-modal" id="theme-modal-close">X</span>
      </div>
      <div class="theme-modal-content">
        <div class="theme-modal-body">
          <label
            class="theme-modal-label"
            id="theme-modal-label"
            for="theme-modal-input"
            >THEME NAME:</label
          >
          <input
            type="text"
            class="config-input"
            id="theme-modal-input"
            placeholder="Enter value..."
          />
          <textarea
            class="config-input theme-modal-textarea"
            id="theme-modal-textarea"
            rows="8"
            placeholder="Theme JSON will appear here..."
          ></textarea>
        </div>
        <div class="theme-modal-buttons">
          <button
            class="confirm-btn confirm-btn-cancel"
            id="theme-modal-cancel"
          >
            CANCEL
          </button>
          <button
            class="confirm-btn confirm-btn-primary"
            id="theme-modal-confirm"
          >
            CONFIRM
          </button>
        </div>
      </div>
    </div>

    <!-- NOTE EDITOR MODAL (V3.0 Obsidian-Style) -->
    <div id="note-editor-modal" class="modal note-editor-modal notes-modal">
      <div class="config-header">
        <div style="display: flex; align-items: center; gap: 10px">
          OPERATOR_NOTES //
          <span style="font-size: 0.6rem; opacity: 0.6">BLOCK_OS_v2.0</span>
        </div>
        <div
          style="
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
          "
        >
          <button
            id="note-help-btn"
            class="sidebar-action-btn"
            title="Editor Help"
            style="
              font-size: 0.7rem;
              width: auto;
              padding: 0 8px;
              height: 22px;
              border-color: rgba(255, 255, 255, 0.1);
            "
          >
            [HELP]
          </button>
          <button
            id="note-maximize-btn"
            class="sidebar-action-btn"
            title="Maximize Editor"
            style="
              font-size: 0.7rem;
              width: auto;
              padding: 0 8px;
              height: 22px;
              border-color: rgba(255, 255, 255, 0.1);
            "
          >
            [MAX]
          </button>
        </div>
        <span class="close-modal" id="note-editor-close">X</span>
      </div>
      <div class="notes-container">
        <!-- SIDEBAR -->
        <div class="notes-sidebar">
          <div
            class="sidebar-header"
            style="
              flex-direction: column;
              align-items: stretch;
              gap: 8px;
              padding: 10px;
            "
          >
            <div
              style="
                font-size: 0.6rem;
                color: #444;
                letter-spacing: 2px;
                font-family: monospace;
                border-bottom: 1px solid rgba(255, 255, 255, 0.02);
                padding-bottom: 4px;
                margin-bottom: 2px;
              "
            >
              NAV_SYSTEM // OPERATOR
            </div>
            <div
              style="
                display: flex;
                justify-content: flex-start;
                align-items: center;
                gap: 6px;
                flex-wrap: wrap;
              "
            >
              <button
                id="daily-note-btn"
                class="sidebar-action-btn"
                title="Open Daily Note"
                style="
                  font-size: 0.75rem;
                  width: auto;
                  padding: 0 8px;
                  height: 26px;
                  flex-shrink: 0;
                "
              >
                [DAY]
              </button>
              <button
                id="open-graph-btn"
                class="sidebar-action-btn"
                title="Visual Graph View"
                style="
                  font-size: 0.75rem;
                  width: auto;
                  padding: 0 8px;
                  height: 26px;
                  flex-shrink: 0;
                "
              >
                [GRAPH]
              </button>
              <!-- V63.4: [TASK] button removed - Task Manager deprecated -->
              <button
                id="add-folder-btn-sidebar"
                class="sidebar-action-btn"
                title="Create New Folder"
                style="
                  font-size: 0.75rem;
                  width: auto;
                  padding: 0 8px;
                  height: 26px;
                  flex-shrink: 0;
                "
              >
                [+FLD]
              </button>
              <button
                id="add-board-btn-sidebar"
                class="sidebar-action-btn"
                title="Create New Board"
                style="
                  font-size: 0.75rem;
                  width: auto;
                  padding: 0 8px;
                  height: 26px;
                  flex-shrink: 0;
                "
              >
                [+BOARD]
              </button>
              <button
                id="add-note-btn-sidebar"
                class="sidebar-action-btn"
                title="INITIALIZE_NEW_ENTRY"
                style="
                  height: 26px;
                  width: 26px;
                  font-weight: bold;
                  flex-shrink: 0;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                "
              >
                +
              </button>
            </div>
            <div class="search-container">
              <input
                type="text"
                id="notes-search"
                placeholder="SEARCH NOTES..."
                autocomplete="off"
              />
            </div>
          </div>
          <div id="sidebar-tags-section" class="sidebar-tags-section">
            <div class="tags-header" id="tags-header-toggle">
              <span>TAGS</span>
              <span class="tags-toggle">v</span>
            </div>
            <div id="sidebar-all-tags" class="sidebar-all-tags"></div>
          </div>
          <div id="notes-list-sidebar"></div>
          <div class="sidebar-footer">
            <button
              id="selection-mode-btn"
              class="text-btn"
              title="Select multiple notes"
            >
              SELECT
            </button>
            <button
              id="delete-selected-btn"
              class="text-btn danger-btn"
              style="display: none"
            >
              DELETE (0)
            </button>
          </div>
        </div>

        <!-- EDITOR AREA -->
        <div class="notes-editor">
          <!-- V63.2: Tab Bar -->
          <div class="editor-tab-bar" id="editor-tab-bar">
            <div class="tab-nav">
              <button class="tab-nav-btn" id="tab-nav-back" title="Back">
                &lt;
              </button>
              <button class="tab-nav-btn" id="tab-nav-forward" title="Forward">
                &gt;
              </button>
            </div>
            <div class="tabs-container" id="tabs-container">
              <!-- Tabs rendered dynamically -->
            </div>
            <button class="tab-new-btn" id="tab-new-btn" title="New Tab">
              +
            </button>
          </div>
          <!-- V63.2: Slimmer Header -->
          <div class="editor-header">
            <div class="editor-header-left">
              <button
                id="sidebar-toggle-btn"
                class="text-btn"
                title="Toggle Sidebar"
              >
                SIDEBAR
              </button>
              <input
                type="text"
                id="active-note-title"
                placeholder="ENTER_ENTRY_TITLE..."
                autocomplete="off"
              />
              <input
                type="text"
                id="note-current-path"
                class="note-path-input"
                value="/root"
                placeholder="/path"
                autocomplete="off"
              />
            </div>
            <div class="editor-header-right">
              <span id="note-timestamp">--</span>
              <button id="pin-note-btn" class="text-btn" title="Pin Note">
                PIN
              </button>
              <button
                id="preview-toggle"
                class="text-btn"
                title="Toggle Preview"
              >
                EDIT
              </button>
              <button
                id="page-actions-btn"
                class="text-btn page-actions-trigger"
                title="Page Actions"
              >
                ...
              </button>
              <!-- V63.2: Page Actions Dropdown (inside header-right for correct positioning) -->
              <div id="page-actions-menu" class="page-actions-menu">
                <input
                  type="text"
                  id="page-actions-search"
                  class="page-actions-search"
                  placeholder="Search actions..."
                />
                <div class="page-actions-list">
                  <div class="page-action-item" data-action="pin-toggle">
                    <span>Pin Note</span><kbd>CMD+P</kbd>
                  </div>
                  <div class="page-action-item" data-action="duplicate">
                    <span>Duplicate Note</span><kbd>CMD+D</kbd>
                  </div>
                  <div class="page-action-item" data-action="move-to">
                    <span>Move to Folder</span><kbd>CMD+SHIFT+P</kbd>
                  </div>
                  <div class="page-action-divider"></div>
                  <div class="page-action-item" data-action="copy-content">
                    <span>Copy Content</span>
                  </div>
                  <div class="page-action-item" data-action="export-md">
                    <span>Export as Markdown</span>
                  </div>
                  <div class="page-action-item" data-action="import-md">
                    <span>Import Markdown</span>
                  </div>
                  <div class="page-action-divider"></div>
                  <div class="page-action-item" data-action="convert-board">
                    <span>Convert to Board</span>
                  </div>
                  <div class="page-action-item" data-action="show-graph">
                    <span>Show in Graph</span>
                  </div>
                  <div class="page-action-divider"></div>
                  <div class="page-action-item danger" data-action="trash">
                    <span>Move to Trash</span><kbd>CMD+SHIFT+D</kbd>
                  </div>
                </div>
                <div class="page-actions-footer">
                  <span id="page-action-word-count">0 words</span>
                  <span id="page-action-last-edited">--</span>
                </div>
              </div>
            </div>
          </div>
          <div
            id="block-editor"
            class="block-editor"
            data-placeholder="Type '/' for commands..."
          ></div>
          <div id="note-preview" class="note-preview"></div>
          <!-- V63.2: Tags bar (replaces footer) -->
          <div class="editor-tags-bar">
            <span id="note-tags"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- FOLDER CREATE MODAL (V3.9) -->
    <div id="folder-create-modal" class="modal">
      <div class="config-header">
        CREATE NEW FOLDER
        <span class="close-modal" id="folder-modal-close">X</span>
      </div>
      <div class="folder-modal-body">
        <div
          style="
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
          "
        >
          Folder Name
        </div>
        <input
          type="text"
          id="folder-name-input"
          class="folder-modal-input"
          placeholder="e.g. Projects/Work"
          autocomplete="off"
        />
      </div>
      <div class="folder-modal-footer">
        <button class="confirm-btn confirm-btn-cancel" id="folder-modal-cancel">
          CANCEL
        </button>
        <button
          class="confirm-btn confirm-btn-primary"
          id="folder-modal-confirm"
        >
          CREATE
        </button>
      </div>
    </div>

    <!-- GRAPH VIEW MODAL (PHASE 9) -->
    <div
      id="graph-modal"
      class="modal graph-modal"
      style="
        width: 90vw;
        height: 85vh;
        max-width: 1400px;
        max-height: 900px;
        display: none;
        flex-direction: column;
      "
    >
      <div class="config-header">
        KNOWLEDGE_GRAPH //
        <div
          style="
            display: flex;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
            margin-left: 20px;
          "
        >
          <input
            type="text"
            id="graph-search"
            placeholder="Filter nodes..."
            autocomplete="off"
            style="
              width: 200px;
              background: rgba(255, 255, 255, 0.03);
              border: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.3);
              color: var(--main-color);
              padding: 5px 10px;
              font-family: monospace;
              font-size: 0.8rem;
              border-radius: 2px;
              outline: none;
            "
          />
          <button class="graph-mode-toggle" id="graph-mode-toggle">
            GLOBAL
          </button>
        </div>
        <span class="close-modal" id="graph-modal-close">X</span>
      </div>
      <div
        id="graph-container"
        style="
          flex-grow: 1;
          position: relative;
          overflow: hidden;
          background: transparent;
        "
      ></div>
      <div
        class="graph-legend"
        id="graph-legend"
        style="
          position: absolute;
          bottom: 20px;
          right: 20px;
          background: rgba(0, 0, 0, 0.6);
          border: 1px solid rgba(var(--main-color-rgb, 0, 255, 65), 0.2);
          backdrop-filter: blur(5px);
          padding: 10px;
          font-size: 0.7rem;
          color: #888;
          display: flex;
          gap: 15px;
          flex-wrap: wrap;
          pointer-events: none;
          z-index: 10;
          border-radius: 4px;
        "
      ></div>
    </div>

    <!-- NOTE EDITOR HELP MODAL (V3.9) -->
    <div id="note-help-modal" class="modal note-help-modal">
      <div class="config-header">
        EDITOR_GUIDE // SHORTCUTS
        <span class="close-modal" id="note-help-close">X</span>
      </div>
      <div
        class="modal-body"
        style="
          padding: 20px;
          font-family: var(--font-secondary);
          font-size: 0.85rem;
          color: #aaa;
          line-height: 1.6;
          overflow-y: auto;
          flex: 1;
        "
      >
        <div
          style="
            margin-bottom: 15px;
            color: var(--main-color);
            font-size: 0.7rem;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 5px;
          "
        >
          TEXT_STYLING
        </div>
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
          "
        >
          <div>
            <code style="color: #eee">CMD+B</code> : <strong>Bold</strong>
          </div>
          <div><code style="color: #eee">CMD+I</code> : <em>Italic</em></div>
          <div><code style="color: #eee">CMD+U</code> : <u>Underline</u></div>
          <div><code style="color: #eee">CMD+K</code> : [Link]()</div>
          <div><code style="color: #eee">CMD+L</code> : [[WikiLink]]</div>
          <div>
            <code style="color: #eee">CMD+A x2</code> : Select All Blocks
          </div>
        </div>

        <div
          style="
            margin-bottom: 15px;
            color: var(--main-color);
            font-size: 0.7rem;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 5px;
          "
        >
          BLOCK_COMMANDS
        </div>
        <ul style="list-style: none; padding: 0; margin: 0 0 20px 0">
          <li style="margin-bottom: 5px">
            <code style="color: #eee">/</code> : Command Palette (Headers, Code,
            Boards)
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">ENTER</code> : Split Block at Cursor
            (Notion-like)
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">BACKSPACE</code> : Merge with Previous
            Block (at start)
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">ARROW UP/DOWN</code> : Navigate Between
            Blocks
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+ARROW</code> : Quick Block Navigation
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">DRAG</code> : Reorder Blocks via Handle
          </li>
        </ul>

        <div
          style="
            margin-bottom: 15px;
            color: var(--main-color);
            font-size: 0.7rem;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 5px;
          "
        >
          EDITOR_SHORTCUTS
        </div>
        <ul style="list-style: none; padding: 0; margin: 0 0 20px 0">
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+E</code> : Toggle Editor/Preview Mode
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+\</code> : Toggle Sidebar
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+P</code> : Pin Note
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+S</code> : Manual Save
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+N</code> : New Note (in current
            folder)
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+J</code> : Open Daily Note
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+1-9</code> : Switch to Tab by Number
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">CMD+SHIFT+X</code> : Close Current Tab
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">ARROW LEFT/RIGHT</code> : Navigate Open
            Tabs
          </li>
        </ul>

        <div
          style="
            margin-bottom: 15px;
            color: var(--main-color);
            font-size: 0.7rem;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 5px;
          "
        >
          CLI_COMMANDS
        </div>
        <ul style="list-style: none; padding: 0; margin: 0">
          <li style="margin-bottom: 5px">
            <code style="color: #eee">weather set [loc]</code> : Set Weather
            Location
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">[GRAPH]</code> : Knowledge Graph View
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">[+BOARD]</code> : Initialize Kanban Board
          </li>
          <li style="margin-bottom: 5px">
            <code style="color: #eee">ESC</code> : Return / Close
          </li>
        </ul>
      </div>
    </div>

    <style>
      /* =========================================
         CALLOUT MODAL STYLES (Migrated)
         ========================================= */
      .callout-modal-content {
          width: 600px;
          max-width: 90%;
          background: #0a0a0a;
          border: 2px solid var(--main-color);
          border-radius: 8px;
          overflow: hidden;
          display: flex;
          flex-direction: column;
      }

      .callout-modal-header {
          padding: 20px;
          border-bottom: 1px solid #333;
          background: rgba(var(--main-color-rgb), 0.05); /* Fixed rgba syntax */
      }

      .callout-modal-body {
          padding: 20px;
          max-height: 70vh;
          overflow-y: auto;
      }
      
      .callout-form-section { margin-bottom: 20px; }
      .callout-label {
          display: block; color: var(--main-color); font-weight: bold;
          font-size: 12px; margin-bottom: 8px; letter-spacing: 1px;
      }
      
      .callout-type-grid {
          display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;
      }
      .callout-type-btn {
          display: flex; align-items: center; gap: 8px; padding: 12px;
          background: #1a1a1a; border: 2px solid #333; border-radius: 6px;
          color: #888; cursor: pointer; transition: all 0.2s ease;
          font-family: var(--font-main);
      }
      .callout-type-btn:hover { border-color: #555; background: #222; }
      .callout-type-btn.selected { border-width: 2px; font-weight: bold; }
      
      .callout-input, .callout-textarea {
          width: 100%; padding: 10px 12px; background: #1a1a1a;
          border: 1px solid #333; border-radius: 4px; color: var(--main-color);
          font-family: var(--font-main); font-size: 14px;
          transition: border-color 0.2s ease; box-sizing: border-box;
      }
      .callout-input:focus, .callout-textarea:focus {
          outline: none; border-color: var(--main-color);
          box-shadow: 0 0 0 2px rgba(var(--main-color-rgb), 0.1); /* Fixed rgba */
      }
      
      .callout-modal-footer {
          padding: 15px 20px; border-top: 1px solid #333;
          display: flex; justify-content: flex-end; gap: 10px;
          background: rgba(0, 0, 0, 0.5);
      }
      
      /* Canvas Styles */
      .canvas-board {
          position: absolute; top: 0; left: 0; width: 100%; height: 100%;
          transform-origin: 0 0; will-change: transform;
      }
      .canvas-card {
          position: absolute; background: #111; border: 1px solid var(--main-color);
          padding: 10px; width: 220px; height: 160px; overflow: hidden;
          color: var(--main-color); box-shadow: 0 4px 15px rgba(0,0,0,0.5);
          border-radius: 4px;
      }
      
      /* Buttons */
      .btn {
          padding: 8px 16px; background: transparent;
          border: 1px solid var(--secondary-color); color: var(--secondary-color);
          font-family: var(--font-main); font-size: 12px; cursor: pointer;
          border-radius: 4px; transition: all 0.2s ease; font-weight: bold;
      }
      .btn:hover { border-color: var(--main-color); color: var(--main-color); }
      .btn.primary-btn {
          background: var(--main-color); color: #000; border-color: var(--main-color);
      }
      .btn.primary-btn:hover { filter: brightness(1.1); }
    </style>

    <!-- MISSION LOG (TASKS) -->
    <div id="mission-log">
      <div class="panel-header">
        ACTIVE_MISSIONS //
        <span class="panel-action" id="clear-tasks">CLR &#10003;</span>
      </div>
      <div id="mission-list"></div>
    </div>

    <!-- NOTES PANEL -->
    <div id="notes-panel">
      <div
        class="panel-header"
        id="quick-notes-panel-header"
        style="cursor: pointer"
        title="Open Main Editor"
      >
        QUICK_NOTES //
        <span class="panel-action" id="add-note-btn" title="Create New Note"
          >ADD</span
        >
        <span style="color: #333; margin: 0 3px">|</span>
        <span class="panel-action" id="clear-notes" title="Clear All Notes"
          >CLR</span
        >
      </div>
      <div id="notes-list"></div>
    </div>

    <!-- NOTES DISCOVERY HINT (First-Time Users) -->
    <div id="notes-discovery-hint">
        <div class="discovery-header">NOTES //</div>
        <div class="discovery-body">
            Use the CLI below to create your first note:<br>
            <code class="discovery-cmd">note &lt;title&gt;</code>
        </div>
        <div class="discovery-footer">
            <span id="notes-discovery-dismiss" class="discovery-dismiss">GOT IT</span>
        </div>
    </div>

    <!-- HUD CONTAINER -->
    <div class="hud-container">
      <div id="greeting">SYSTEM ONLINE</div>
      <div id="clock"></div>
      <div id="date"></div>

      <!-- V18.0: PROGRESS BAR -->
      <div class="progress-container" id="progress-container">
        <div class="progress-outer">
          <div id="progress-bar"></div>
        </div>
        <div id="progress-text">NO TASKS</div>
      </div>

      <!-- POMODORO TIMER -->
      <div id="pomodoro-container">
        <div class="pomodoro-display">
          <div>
            <div class="pomodoro-label">FOCUS MODE</div>
            <div class="pomodoro-time" id="pomodoro-time">25:00</div>
          </div>
          <div class="pomodoro-controls">
            <button class="pomodoro-btn" id="pomodoro-pause">PAUSE</button>
            <button class="pomodoro-btn" id="pomodoro-stop">STOP</button>
          </div>
        </div>
      </div>

      <div class="input-group">
        <div class="cmd-wrapper">
          <div class="cmd-main-row">
            <span class="prompt">&gt;_</span>
            <input
              type="text"
              id="cmd-input"
              name="cmd-input"
              placeholder="AWAITING INPUT..."
              autocomplete="off"
              spellcheck="false"
            />
          </div>
          <div id="command-hint"></div>
        </div>
        <div id="suggestions"></div>
      </div>

      <div class="dock" id="dock"></div>
    </div>

    <!-- BOOKMARKS BAR -->
    <div id="bookmarks-container"></div>

    <!-- KEYBOARD SHORTCUT HINT -->
    <div id="shortcut-hint">
      <kbd>/</kbd> or <kbd>Ctrl</kbd>+<kbd>K</kbd> to focus | <kbd>Esc</kbd> to
      close
    </div>

    <!-- V3.9: Inline Link Popover -->
    <div id="link-popover">
      <span
        class="popover-label"
        id="link-popover-label"
        style="display: block; margin-bottom: 5px"
        >Link URL:</span
      >
      <div style="display: flex; gap: 8px; align-items: center">
        <input type="text" id="link-popover-input" placeholder="Type here..." />
        <button id="link-popover-submit" style="height: 38px; padding: 0 15px">
          OK
        </button>
      </div>
      <button id="link-popover-remove" class="remove-btn" style="display: none">
        [ REMOVE LINK ]
      </button>
    </div>

    <!-- POMODORO HUD (V61) -->
    <div id="pomo-hud" onclick="this.classList.remove('active')">
      <div class="hud-scanlines"></div>
      <div class="hud-header">
        <span>SIGNAL // ALERT</span>
        <span id="hud-time">--:--</span>
      </div>
      <div class="hud-title">FOCUS COMPLETE</div>
      <div class="hud-subtitle">Operator, time for a break.</div>
      <div class="hud-glitch-bar" style="margin-top: 10px"></div>
    </div>

    <!-- CANVAS MODAL (Phase 3) -->
    <div id="canvas-modal" class="modal">
        <div class="modal-content" style="width: 95%; height: 90%; max-width: none; display: flex; flex-direction: column; background: #000; border: 2px solid var(--main-color);">
            <div class="modal-header" style="flex-shrink: 0; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid #333;">
                <h2 id="canvas-title" style="margin: 0; font-size: 14px;">CANVAS //</h2>
                <div style="display: flex; gap: 10px;">
                    <span class="panel-action" onclick="window.CanvasManager.createNode('text', 0, 0, 'New Node')">+ NODE</span>
                    <span class="panel-action" onclick="window.CanvasManager.showGrid = !window.CanvasManager.showGrid; window.CanvasManager.render()">GRID</span>
                    <span class="panel-action" onclick="window.CanvasManager.scale = 1; window.CanvasManager.viewportX = 0; window.CanvasManager.viewportY = 0; window.CanvasManager.render()">RESET</span>
                    <span class="panel-action close-modal" style="color: var(--danger-color, #ff0055);">CLOSE</span>
                </div>
            </div>
            <div style="flex: 1; position: relative; overflow: hidden; background: #000;">
                <canvas id="canvas-viewport" style="display: block; width: 100%; height: 100%;"></canvas>
            </div>
            <div style="flex-shrink: 0; padding: 8px 15px; background: rgba(0,0,0,0.8); border-top: 1px solid #333;">
                <span style="color: #555; font-size: 11px; letter-spacing: 0.5px;">
                    DBL-CLICK: create node | DRAG: move | SCROLL: zoom |
                    SELECT + C: connect | DEL: remove | G: toggle grid
                </span>
            </div>
        </div>
    </div>

    <script type="module" src="js/boot.js"></script>
  </body>
</html>
